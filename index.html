<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>Origin Policy</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
<style data-fill-with="stylesheet">/******************************************************************************
 *                   Style sheet for the W3C specifications                   *
 *
 * Special classes handled by this style sheet include:
 *
 * Indices
 *   - .toc for the Table of Contents (<ol class="toc">)
 *     + <span class="secno"> for the section numbers
 *   - #toc for the Table of Contents (<nav id="toc">)
 *   - ul.index for Indices (<a href="#ref">term</a><span>, in §N.M</span>)
 *   - table.index for Index Tables (e.g. for properties or elements)
 *
 * Structural Markup
 *   - table.data for general data tables
 *     -> use 'scope' attribute, <colgroup>, <thead>, and <tbody> for best results !
 *     -> use <table class='complex data'> for extra-complex tables
 *     -> use <td class='long'> for paragraph-length cell content
 *     -> use <td class='pre'> when manual line breaks/indentation would help readability
 *   - dl.switch for switch statements
 *   - ol.algorithm for algorithms (helps to visualize nesting)
 *   - .figure and .caption (HTML4) and figure and figcaption (HTML5)
 *     -> .sidefigure for right-floated figures
 *   - ins/del
 *
 * Code
 *   - pre and code
 *
 * Special Sections
 *   - .note       for informative notes             (div, p, span, aside, details)
 *   - .example    for informative examples          (div, p, pre, span)
 *   - .issue      for issues                        (div, p, span)
 *   - .assertion  for assertions                    (div, p, span)
 *   - .advisement for loud normative statements     (div, p, strong)
 *   - .annoying-warning for spec obsoletion notices (div, aside, details)
 *
 * Definition Boxes
 *   - pre.def   for WebIDL definitions
 *   - table.def for tables that define other entities (e.g. CSS properties)
 *   - dl.def    for definition lists that define other entitles (e.g. HTML elements)
 *
 * Numbering
 *   - .secno for section numbers in .toc and headings (<span class='secno'>3.2</span>)
 *   - .marker for source-inserted example/figure/issue numbers (<span class='marker'>Issue 4</span>)
 *   - ::before styled for CSS-generated issue/example/figure numbers:
 *     -> Documents wishing to use this only need to add
 *        figcaption::before,
 *        .caption::before { content: "Figure "  counter(figure);  }
 *        .example::before { content: "Example " counter(example); }
 *        .issue::before   { content: "Issue "   counter(issue);   }
 *
 * Header Stuff (ignore, just don't conflict with these classes)
 *   - .head for the header
 *   - .copyright for the copyright
 *
 * Miscellaneous
 *   - .overlarge for things that should be as wide as possible, even if
 *     that overflows the body text area. This can be used on an item or
 *     on its container, depending on the effect desired.
 *     Note that this styling basically doesn't help at all when printing,
 *     since A4 paper isn't much wider than the max-width here.
 *     It's better to design things to fit into a narrower measure if possible.
 *   - js-added ToC jump links (see fixup.js)
 *
 ******************************************************************************/

/******************************************************************************/
/*                                   Body                                     */
/******************************************************************************/

	body {
		counter-reset: example figure issue;

		/* Layout */
		max-width: 50em;               /* limit line length to 50em for readability   */
		margin: 0 auto;                /* center text within page                     */
		padding: 1.6em 1.5em 2em 50px; /* assume 16px font size for downlevel clients */
		padding: 1.6em 1.5em 2em calc(26px + 1.5em); /* leave space for status flag     */

		/* Typography */
		line-height: 1.5;
		font-family: sans-serif;
		widows: 2;
		orphans: 2;
		word-wrap: break-word;
		overflow-wrap: break-word;
		hyphens: auto;

		/* Colors */
		color: black;
		background: white top left fixed no-repeat;
		background-size: 25px auto;
	}


/******************************************************************************/
/*                         Front Matter & Navigation                          */
/******************************************************************************/

/** Header ********************************************************************/

	div.head { margin-bottom: 1em }
	div.head hr { border-style: solid; }

	div.head h1 {
		font-weight: bold;
		margin: 0 0 .1em;
		font-size: 220%;
	}

	div.head h2 { margin-bottom: 1.5em;}

/** W3C Logo ******************************************************************/

	.head .logo {
		float: right;
		margin: 0.4rem 0 0.2rem .4rem;
	}

	.head img[src*="logos/W3C"] {
		display: block;
		border: solid #1a5e9a;
		border-width: .65rem .7rem .6rem;
		border-radius: .4rem;
		background: #1a5e9a;
		color: white;
		font-weight: bold;
	}

	.head a:hover > img[src*="logos/W3C"],
	.head a:focus > img[src*="logos/W3C"] {
		opacity: .8;
	}

	.head a:active > img[src*="logos/W3C"] {
		background: #c00;
		border-color: #c00;
	}

	/* see also additional rules in Link Styling section */

/** Copyright *****************************************************************/

	p.copyright,
	p.copyright small { font-size: small }

/** Back to Top / ToC Toggle **************************************************/

	@media print {
		#toc-nav {
			display: none;
		}
	}
	@media not print {
		#toc-nav {
			position: fixed;
			z-index: 2;
			bottom: 0; left: 0;
			margin: 0;
			min-width: 1.33em;
			border-top-right-radius: 2rem;
			box-shadow: 0 0 2px;
			font-size: 1.5em;
			color: black;
		}
		#toc-nav > a {
			display: block;
			white-space: nowrap;

			height: 1.33em;
			padding: .1em 0.3em;
			margin: 0;

			background: white;
			box-shadow: 0 0 2px;
			border: none;
			border-top-right-radius: 1.33em;
			background: white;
		}
		#toc-nav > #toc-jump {
			padding-bottom: 2em;
			margin-bottom: -1.9em;
		}

		#toc-nav > a:hover,
		#toc-nav > a:focus {
			background: #f8f8f8;
		}
		#toc-nav > a:not(:hover):not(:focus) {
			color: #707070;
		}

		/* statusbar gets in the way on keyboard focus; remove once browsers fix */
		#toc-nav > a[href="#toc"]:not(:hover):focus:last-child {
			padding-bottom: 1.5rem;
		}

		#toc-nav:not(:hover) > a:not(:focus) > span + span {
			/* Ideally this uses :focus-within on #toc-nav */
			display: none;
		}
		#toc-nav > a > span + span {
			padding-right: 0.2em;
		}

		#toc-toggle-inline {
			vertical-align: 0.05em;
			font-size: 80%;
			color: gray;
			color: hsla(203,20%,40%,.7);
			border-style: none;
			background: transparent;
			position: relative;
		}
		#toc-toggle-inline:hover:not(:active),
		#toc-toggle-inline:focus:not(:active) {
			text-shadow: 1px 1px silver;
			top: -1px;
			left: -1px;
		}

		#toc-nav :active {
			color: #C00;
		}
	}

/** ToC Sidebar ***************************************************************/

	/* Floating sidebar */
	@media screen {
		body.toc-sidebar #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			max-width: 80%;
			max-width: calc(100% - 2em - 26px);
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			background: inherit;
			background-color: #f7f8f9;
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
		}
		body.toc-sidebar #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
		}
		body.toc-sidebar #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	/* Hide main scroller when only the ToC is visible anyway */
	@media screen and (max-width: 28em) {
		body.toc-sidebar {
			overflow: hidden;
		}
	}

	/* Sidebar with its own space */
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			background: inherit;
			background-color: #f7f8f9;
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
		}
		body:not(.toc-inline) #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
		}

		body:not(.toc-inline) {
			padding-left: 29em;
		}
		/* See also Overflow section at the bottom */

		body:not(.toc-inline) #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) {
			margin: 0 4em;
		}
	}

/******************************************************************************/
/*                                Sectioning                                  */
/******************************************************************************/

/** Headings ******************************************************************/

	h1, h2, h3, h4, h5, h6, dt {
		page-break-after: avoid;
		page-break-inside: avoid;
		font: 100% sans-serif;   /* Reset all font styling to clear out UA styles */
		font-family: inherit;    /* Inherit the font family. */
		line-height: 1.2;        /* Keep wrapped headings compact */
		hyphens: manual;         /* Hyphenated headings look weird */
	}

	h2, h3, h4, h5, h6 {
		margin-top: 3rem;
	}

	h1, h2, h3 {
		color: #005A9C;
		background: transparent;
	}

	h1 { font-size: 170%; }
	h2 { font-size: 140%; }
	h3 { font-size: 120%; }
	h4 { font-weight: bold; }
	h5 { font-style: italic; }
	h6 { font-variant: small-caps; }
	dt { font-weight: bold; }

/** Subheadings ***************************************************************/

	h1 + h2,
	#subtitle {
		/* #subtitle is a subtitle in an H2 under the H1 */
		margin-top: 0;
	}
	h2 + h3,
	h3 + h4,
	h4 + h5,
	h5 + h6 {
		margin-top: 1.2em; /* = 1 x line-height */
	}

/** Section divider ***********************************************************/

	:not(.head) > hr {
		font-size: 1.5em;
		text-align: center;
		margin: 1em auto;
		height: auto;
		border: transparent solid 0;
		background: transparent;
	}
	:not(.head) > hr::before {
		content: "\2727\2003\2003\2727\2003\2003\2727";
	}

/******************************************************************************/
/*                            Paragraphs and Lists                            */
/******************************************************************************/

	p {
		margin: 1em 0;
	}

	dd > p:first-child,
	li > p:first-child {
		margin-top: 0;
	}

	ul, ol {
		margin-left: 0;
		padding-left: 2em;
	}

	li {
		margin: 0.25em 0 0.5em;
		padding: 0;
	}

	dl dd {
		margin: 0 0 .5em 2em;
	}

	.head dd + dd { /* compact for header */
		margin-top: -.5em;
	}

	/* Style for algorithms */
	ol.algorithm ol:not(.algorithm),
	.algorithm > ol ol:not(.algorithm) {
	 border-left: 0.5em solid #DEF;
	}

	/* Style for switch/case <dl>s */
	dl.switch > dd > ol.only,
	dl.switch > dd > .only > ol {
	 margin-left: 0;
	}
	dl.switch > dd > ol.algorithm,
	dl.switch > dd > .algorithm > ol {
	 margin-left: -2em;
	}
	dl.switch {
	 padding-left: 2em;
	}
	dl.switch > dt {
	 text-indent: -1.5em;
	 margin-top: 1em;
	}
	dl.switch > dt + dt {
	 margin-top: 0;
	}
	dl.switch > dt::before {
	 content: '\21AA';
	 padding: 0 0.5em 0 0;
	 display: inline-block;
	 width: 1em;
	 text-align: right;
	 line-height: 0.5em;
	}

/** Terminology Markup ********************************************************/


/******************************************************************************/
/*                                 Inline Markup                              */
/******************************************************************************/

/** Terminology Markup ********************************************************/
	dfn   { /* Defining instance */
		font-weight: bolder;
	}
	a > i { /* Instance of term */
		font-style: normal;
	}
	dt dfn code, code.idl {
		font-size: inherit;
	}
	dfn var {
		font-style: normal;
	}

/** Change Marking ************************************************************/

	del { color: red;  text-decoration: line-through; }
	ins { color: #080; text-decoration: underline;    }

/** Miscellaneous improvements to inline formatting ***************************/

	sup {
		vertical-align: super;
		font-size: 80%
	}

/******************************************************************************/
/*                                    Code                                    */
/******************************************************************************/

/** General monospace/pre rules ***********************************************/

	pre, code, samp {
		font-family: Menlo, Consolas, "DejaVu Sans Mono", Monaco, monospace;
		font-size: .9em;
		page-break-inside: avoid;
		hyphens: none;
		text-transform: none;
	}
	pre code,
	code code {
		font-size: 100%;
	}

	pre {
		margin-top: 1em;
		margin-bottom: 1em;
		overflow: auto;
	}

/** Inline Code fragments *****************************************************/

  /* Do something nice. */

/******************************************************************************/
/*                                    Links                                   */
/******************************************************************************/

/** General Hyperlinks ********************************************************/

	/* We hyperlink a lot, so make it less intrusive */
	a[href] {
		color: #034575;
		text-decoration: none;
		border-bottom: 1px solid #707070;
		/* Need a bit of extending for it to look okay */
		padding: 0 1px 0;
		margin: 0 -1px 0;
	}
	a:visited {
		border-bottom-color: #BBB;
	}

	/* Use distinguishing colors when user is interacting with the link */
	a[href]:focus,
	a[href]:hover {
		background: #f8f8f8;
		background: rgba(75%, 75%, 75%, .25);
		border-bottom-width: 3px;
		margin-bottom: -2px;
	}
	a[href]:active {
		color: #C00;
		border-color: #C00;
	}

	/* Backout above styling for W3C logo */
	.head .logo,
	.head .logo a {
		border: none;
		text-decoration: none;
		background: transparent;
	}

/******************************************************************************/
/*                                    Images                                  */
/******************************************************************************/

	img {
		border-style: none;
	}

	/* For autogen numbers, add
	   .caption::before, figcaption::before { content: "Figure " counter(figure) ". "; }
	*/

	figure, .figure, .sidefigure {
		page-break-inside: avoid;
		text-align: center;
		margin: 2.5em 0;
	}
	.figure img,    .sidefigure img,    figure img,
	.figure object, .sidefigure object, figure object {
		max-width: 100%;
		margin: auto;
	}
	.figure pre, .sidefigure pre, figure pre {
		text-align: left;
		display: table;
		margin: 1em auto;
	}
	.figure table, figure table {
		margin: auto;
	}
	@media screen and (min-width: 20em) {
		.sidefigure {
			float: right;
			width: 50%;
			margin: 0 0 0.5em 0.5em
		}
	}
	.caption, figcaption, caption {
		font-style: italic;
		font-size: 90%;
	}
	.caption::before, figcaption::before, figcaption > .marker {
		font-weight: bold;
	}
	.caption, figcaption {
		counter-increment: figure;
	}

	/* DL list is indented 2em, but figure inside it is not */
	dd > .figure, dd > figure { margin-left: -2em }

/******************************************************************************/
/*                             Colored Boxes                                  */
/******************************************************************************/

	.issue, .note, .example, .assertion, .advisement, blockquote {
		padding: .5em;
		border: .5em;
		border-left-style: solid;
		page-break-inside: avoid;
	}
	span.issue, span.note {
		padding: .1em .5em .15em;
		border-right-style: solid;
	}

	.issue,
	.note,
	.example,
	.advisement,
	.assertion,
	blockquote {
		margin: 1em auto;
	}
	.note  > p:first-child,
	.issue > p:first-child,
	blockquote > :first-child {
		margin-top: 0;
	}
	blockquote > :last-child {
		margin-bottom: 0;
	}

/** Blockquotes ***************************************************************/

	blockquote {
		border-color: silver;
	}

/** Open issue ****************************************************************/

	.issue {
		border-color: #E05252;
		background: #FBE9E9;
		counter-increment: issue;
		overflow: auto;
	}
	.issue::before, .issue > .marker {
		text-transform: uppercase;
		color: #AE1E1E;
		padding-right: 1em;
		text-transform: uppercase;
	}
	/* Add .issue::before { content: "Issue " counter(issue); } for autogen numbers,
	   or use class="marker" to mark up the issue number in source. */

/** Example *******************************************************************/

	.example {
		border-color: #E0CB52;
		background: #FCFAEE;
		counter-increment: example;
		overflow: auto;
		clear: both;
	}
	.example::before, .example > .marker {
		text-transform: uppercase;
		color: #827017;
		min-width: 7.5em;
		display: block;
	}
	/* Add .example::before { content: "Example " counter(example); } for autogen numbers,
	   or use class="marker" to mark up the example number in source. */

/** Non-normative Note ********************************************************/

	.note {
		border-color: #52E052;
		background: #E9FBE9;
		overflow: auto;
	}

	.note::before, .note > .marker,
	details.note > summary::before,
	details.note > summary > .marker {
		text-transform: uppercase;
		display: block;
		color: hsl(120, 70%, 30%);
	}
	/* Add .note::before { content: "Note"; } for autogen label,
	   or use class="marker" to mark up the label in source. */

	details.note > summary {
		display: block;
		color: hsl(120, 70%, 30%);
	}
	details.note[open] > summary {
		border-bottom: 1px silver solid;
	}

/** Assertion Box *************************************************************/
	/*  for assertions in algorithms */

	.assertion {
		border-color: #AAA;
		background: #EEE;
	}

/** Advisement Box ************************************************************/
	/*  for attention-grabbing normative statements */

	.advisement {
		border-color: orange;
		border-style: none solid;
		background: #FFEECC;
	}
	strong.advisement {
		display: block;
		text-align: center;
	}
	.advisement > .marker {
		color: #B35F00;
	}

/** Spec Obsoletion Notice ****************************************************/
	/* obnoxious obsoletion notice for older/abandoned specs. */

	details {
		display: block;
	}
	summary {
		font-weight: bolder;
	}

	.annoying-warning:not(details),
	details.annoying-warning:not([open]) > summary,
	details.annoying-warning[open] {
		background: #fdd;
		color: red;
		font-weight: bold;
		padding: .75em 1em;
		border: thick red;
		border-style: solid;
		border-radius: 1em;
	}
	.annoying-warning :last-child {
		margin-bottom: 0;
	}

@media not print {
	details.annoying-warning[open] {
		position: fixed;
		left: 1em;
		right: 1em;
		bottom: 1em;
		z-index: 1000;
	}
}

	details.annoying-warning:not([open]) > summary {
		text-align: center;
	}

/** Entity Definition Boxes ***************************************************/

	.def {
		padding: .5em 1em;
		background: #DEF;
		margin: 1.2em 0;
		border-left: 0.5em solid #8CCBF2;
	}

/******************************************************************************/
/*                                    Tables                                  */
/******************************************************************************/

	th, td {
		text-align: left;
		text-align: start;
	}

/** Property/Descriptor Definition Tables *************************************/

	table.def {
		/* inherits .def box styling, see above */
		width: 100%;
		border-spacing: 0;
	}

	table.def td,
	table.def th {
		padding: 0.5em;
		vertical-align: baseline;
		border-bottom: 1px solid #bbd7e9;
	}

	table.def > tbody > tr:last-child th,
	table.def > tbody > tr:last-child td {
		border-bottom: 0;
	}

	table.def th {
		font-style: italic;
		font-weight: normal;
		padding-left: 1em;
		width: 3em;
	}

	/* For when values are extra-complex and need formatting for readability */
	table td.pre {
		white-space: pre-wrap;
	}

	/* A footnote at the bottom of a def table */
	table.def           td.footnote {
		padding-top: 0.6em;
	}
	table.def           td.footnote::before {
		content: " ";
		display: block;
		height: 0.6em;
		width: 4em;
		border-top: thin solid;
	}

/** Data tables (and properly marked-up index tables) *************************/
	/*
		 <table class="data"> highlights structural relationships in a table
		 when correct markup is used (e.g. thead/tbody, th vs. td, scope attribute)

		 Use class="complex data" for particularly complicated tables --
		 (This will draw more lines: busier, but clearer.)

		 Use class="long" on table cells with paragraph-like contents
		 (This will adjust text alignment accordingly.)
		 Alternately use class="longlastcol" on tables, to have the last column assume "long".
	*/

	table {
		word-wrap: normal;
		overflow-wrap: normal;
		hyphens: manual;
	}

	table.data,
	table.index {
		margin: 1em auto;
		border-collapse: collapse;
		border: hidden;
		width: 100%;
	}
	table.data caption,
	table.index caption {
		max-width: 50em;
		margin: 0 auto 1em;
	}

	table.data td,  table.data th,
	table.index td, table.index th {
		padding: 0.5em 1em;
		border-width: 1px;
		border-color: silver;
		border-top-style: solid;
	}

	table.data thead td:empty {
		padding: 0;
		border: 0;
	}

	table.data  thead,
	table.index thead,
	table.data  tbody,
	table.index tbody {
		border-bottom: 2px solid;
	}

	table.data colgroup,
	table.index colgroup {
		border-left: 2px solid;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		border-right: 2px solid;
		border-top: 1px solid silver;
		padding-right: 1em;
	}

	table.data th[colspan],
	table.data td[colspan] {
		text-align: center;
	}

	table.complex.data th,
	table.complex.data td {
		border: 1px solid silver;
		text-align: center;
	}

	table.data.longlastcol td:last-child,
	table.data td.long {
	 vertical-align: baseline;
	 text-align: left;
	}

	table.data img {
		vertical-align: middle;
	}


/*
Alternate table alignment rules

	table.data,
	table.index {
		text-align: center;
	}

	table.data  thead th[scope="row"],
	table.index thead th[scope="row"] {
		text-align: right;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		text-align: right;
	}

Possible extra rowspan handling

	table.data  tbody th[rowspan]:not([rowspan='1']),
	table.index tbody th[rowspan]:not([rowspan='1']),
	table.data  tbody td[rowspan]:not([rowspan='1']),
	table.index tbody td[rowspan]:not([rowspan='1']) {
		border-left: 1px solid silver;
	}

	table.data  tbody th[rowspan]:first-child,
	table.index tbody th[rowspan]:first-child,
	table.data  tbody td[rowspan]:first-child,
	table.index tbody td[rowspan]:first-child{
		border-left: 0;
		border-right: 1px solid silver;
	}
*/

/******************************************************************************/
/*                                  Indices                                   */
/******************************************************************************/


/** Table of Contents *********************************************************/

	.toc a {
		/* More spacing; use padding to make it part of the click target. */
		padding-top: 0.1rem;
		/* Larger, more consistently-sized click target */
		display: block;
		/* Reverse color scheme */
		color: black;
		border-color: #3980B5;
	}
	.toc a:visited {
		border-color: #054572;
	}
	.toc a:not(:focus):not(:hover) {
		/* Allow colors to cascade through from link styling */
		border-bottom-color: transparent;
	}

	.toc, .toc ol, .toc ul, .toc li {
		list-style: none; /* Numbers must be inlined into source */
		/* because generated content isn't search/selectable and markers can't do multilevel yet */
		margin:  0;
		padding: 0;
		line-height: 1.1rem; /* consistent spacing */
	}

	/* ToC not indented until third level, but font style & margins show hierarchy */
	.toc > li             { font-weight: bold;   }
	.toc > li li          { font-weight: normal; }
	.toc > li li li       { font-size:   95%;    }
	.toc > li li li li    { font-size:   90%;    }
	.toc > li li li li li { font-size:   85%;    }

	.toc > li             { margin: 1.5rem 0;    }
	.toc > li li          { margin: 0.3rem 0;    }
	.toc > li li li       { margin-left: 2rem;   }

	/* Section numbers in a column of their own */
	.toc .secno {
		float: left;
		width: 4rem;
		white-space: nowrap;
	}
	.toc > li li li li .secno {
		font-size: 85%;
	}
	.toc > li li li li li .secno {
		font-size: 100%;
	}

	:not(li) > .toc              { margin-left:  5rem; }
	.toc .secno                  { margin-left: -5rem; }
	.toc > li li li .secno       { margin-left: -7rem; }
	.toc > li li li li .secno    { margin-left: -9rem; }
	.toc > li li li li li .secno { margin-left: -11rem; }

	/* Tighten up indentation in narrow ToCs */
	@media (max-width: 30em) {
		:not(li) > .toc              { margin-left:  4rem; }
		.toc .secno                  { margin-left: -4rem; }
		.toc > li li li              { margin-left:  1rem; }
		.toc > li li li .secno       { margin-left: -5rem; }
		.toc > li li li li .secno    { margin-left: -6rem; }
		.toc > li li li li li .secno { margin-left: -7rem; }
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) :not(li) > .toc              { margin-left:  4rem; }
		body:not(.toc-inline) .toc .secno                  { margin-left: -4rem; }
		body:not(.toc-inline) .toc > li li li              { margin-left:  1rem; }
		body:not(.toc-inline) .toc > li li li .secno       { margin-left: -5rem; }
		body:not(.toc-inline) .toc > li li li li .secno    { margin-left: -6rem; }
		body:not(.toc-inline) .toc > li li li li li .secno { margin-left: -7rem; }
	}
	body.toc-sidebar #toc :not(li) > .toc              { margin-left:  4rem; }
	body.toc-sidebar #toc .toc .secno                  { margin-left: -4rem; }
	body.toc-sidebar #toc .toc > li li li              { margin-left:  1rem; }
	body.toc-sidebar #toc .toc > li li li .secno       { margin-left: -5rem; }
	body.toc-sidebar #toc .toc > li li li li .secno    { margin-left: -6rem; }
	body.toc-sidebar #toc .toc > li li li li li .secno { margin-left: -7rem; }

	.toc li {
		clear: both;
	}


/** Index *********************************************************************/

	/* Index Lists: Layout */
	ul.index       { margin-left: 0; columns: 15em; text-indent: 1em hanging; }
	ul.index li    { margin-left: 0; list-style: none; break-inside: avoid; }
	ul.index li li { margin-left: 1em }
	ul.index dl    { margin-top: 0; }
	ul.index dt    { margin: .2em 0 .2em 20px;}
	ul.index dd    { margin: .2em 0 .2em 40px;}
	/* Index Lists: Typography */
	ul.index ul,
	ul.index dl { font-size: smaller; }
	@media not print {
		ul.index li span {
			white-space: nowrap;
			color: transparent; }
		ul.index li a:hover + span,
		ul.index li a:focus + span {
			color: #707070;
		}
	}

/** Index Tables *****************************************************/
	/* See also the data table styling section, which this effectively subclasses */

	table.index {
		font-size: small;
		border-collapse: collapse;
		border-spacing: 0;
		text-align: left;
		margin: 1em 0;
	}

	table.index td,
	table.index th {
		padding: 0.4em;
	}

	table.index tr:hover td:not([rowspan]),
	table.index tr:hover th:not([rowspan]) {
		background: #f7f8f9;
	}

	/* The link in the first column in the property table (formerly a TD) */
	table.index th:first-child a {
		font-weight: bold;
	}

/******************************************************************************/
/*                                    Print                                   */
/******************************************************************************/

	@media print {
		/* Pages have their own margins. */
		html {
			margin: 0;
		}
		/* Serif for print. */
		body {
			font-family: serif;
		}
	}
	@page {
		margin: 1.5cm 1.1cm;
	}

/******************************************************************************/
/*                                    Legacy                                  */
/******************************************************************************/

	/* This rule is inherited from past style sheets. No idea what it's for. */
	.hide { display: none }



/******************************************************************************/
/*                             Overflow Control                               */
/******************************************************************************/

	.figure .caption, .sidefigure .caption, figcaption {
		/* in case figure is overlarge, limit caption to 50em */
		max-width: 50rem;
		margin-left: auto;
		margin-right: auto;
	}
	.overlarge > table {
		/* limit preferred width of table */
		max-width: 50em;
		margin-left: auto;
		margin-right: auto;
	}

	@media (min-width: 55em) {
		.overlarge {
			margin-left: calc(13px + 26.5rem - 50vw);
			margin-right: calc(13px + 26.5rem - 50vw);
			max-width: none;
		}
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) .overlarge {
			/* 30.5em body padding 50em content area */
			margin-left: calc(40em - 50vw) !important;
			margin-right: calc(40em - 50vw) !important;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) .overlarge {
			/* 4em html margin 30.5em body padding 50em content area */
			margin-left: 0 !important;
			margin-right: calc(84.5em - 100vw) !important;
		}
	}

	@media not print {
		.overlarge {
			overflow-x: auto;
			/* See Lea Verou's explanation background-attachment:
			 * http://lea.verou.me/2012/04/background-attachment-local/
			 *
			background: top left  / 4em 100% linear-gradient(to right,  #ffffff, rgba(255, 255, 255, 0)) local,
			            top right / 4em 100% linear-gradient(to left, #ffffff, rgba(255, 255, 255, 0)) local,
			            top left  / 1em 100% linear-gradient(to right,  #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            top right / 1em 100% linear-gradient(to left, #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            white;
			background-repeat: no-repeat;
			*/
		}
	}
</style>
  <meta content="Bikeshed 1.0.0" name="generator">
<style>/* style-md-lists */

            /* This is a weird hack for me not yet following the commonmark spec
               regarding paragraph and lists. */
            [data-md] > :first-child {
                margin-top: 0;
            }
            [data-md] > :last-child {
                margin-bottom: 0;
            }</style>
<style>/* style-selflinks */

            .heading, .issue, .note, .example, li, dt {
                position: relative;
            }
            a.self-link {
                position: absolute;
                top: 0;
                left: calc(-1 * (3.5rem - 26px));
                width: calc(3.5rem - 26px);
                height: 2em;
                text-align: center;
                border: none;
                transition: opacity .2s;
                opacity: .5;
            }
            a.self-link:hover {
                opacity: 1;
            }
            .heading > a.self-link {
                font-size: 83%;
            }
            li > a.self-link {
                left: calc(-1 * (3.5rem - 26px) - 2em);
            }
            dfn > a.self-link {
                top: auto;
                left: auto;
                opacity: 0;
                width: 1.5em;
                height: 1.5em;
                background: gray;
                color: white;
                font-style: normal;
                transition: opacity .2s, background-color .2s, color .2s;
            }
            dfn:hover > a.self-link {
                opacity: 1;
            }
            dfn > a.self-link:hover {
                color: black;
            }

            a.self-link::before            { content: "¶"; }
            .heading > a.self-link::before { content: "§"; }
            dfn > a.self-link::before      { content: "#"; }</style>
<style>/* style-counters */

            body {
                counter-reset: example figure issue;
            }
            .issue {
                counter-increment: issue;
            }
            .issue:not(.no-marker)::before {
                content: "Issue " counter(issue);
            }

            .example {
                counter-increment: example;
            }
            .example:not(.no-marker)::before {
                content: "Example " counter(example);
            }
            .invalid.example:not(.no-marker)::before,
            .illegal.example:not(.no-marker)::before {
                content: "Invalid Example" counter(example);
            }

            figcaption {
                counter-increment: figure;
            }
            figcaption:not(.no-marker)::before {
                content: "Figure " counter(figure) " ";
            }</style>
<style>/* style-autolinks */

            .css.css, .property.property, .descriptor.descriptor {
                color: #005a9c;
                font-size: inherit;
                font-family: inherit;
            }
            .css::before, .property::before, .descriptor::before {
                content: "‘";
            }
            .css::after, .property::after, .descriptor::after {
                content: "’";
            }
            .property, .descriptor {
                /* Don't wrap property and descriptor names */
                white-space: nowrap;
            }
            .type { /* CSS value <type> */
                font-style: italic;
            }
            pre .property::before, pre .property::after {
                content: "";
            }
            [data-link-type="property"]::before,
            [data-link-type="propdesc"]::before,
            [data-link-type="descriptor"]::before,
            [data-link-type="value"]::before,
            [data-link-type="function"]::before,
            [data-link-type="at-rule"]::before,
            [data-link-type="selector"]::before,
            [data-link-type="maybe"]::before {
                content: "‘";
            }
            [data-link-type="property"]::after,
            [data-link-type="propdesc"]::after,
            [data-link-type="descriptor"]::after,
            [data-link-type="value"]::after,
            [data-link-type="function"]::after,
            [data-link-type="at-rule"]::after,
            [data-link-type="selector"]::after,
            [data-link-type="maybe"]::after {
                content: "’";
            }

            [data-link-type].production::before,
            [data-link-type].production::after,
            .prod [data-link-type]::before,
            .prod [data-link-type]::after {
                content: "";
            }

            [data-link-type=element],
            [data-link-type=element-attr] {
                font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
                font-size: .9em;
            }
            [data-link-type=element]::before { content: "<" }
            [data-link-type=element]::after  { content: ">" }

            [data-link-type=biblio] {
                white-space: pre;
            }</style>
<style>/* style-dfn-panel */

        .dfn-panel {
            position: absolute;
            z-index: 35;
            height: auto;
            width: -webkit-fit-content;
            width: fit-content;
            max-width: 300px;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.75em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: #DDDDDD;
            color: black;
            border: outset 0.2em;
        }
        .dfn-panel:not(.on) { display: none; }
        .dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
        .dfn-panel > b { display: block; }
        .dfn-panel a { color: black; }
        .dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
        .dfn-panel > b + b { margin-top: 0.25em; }
        .dfn-panel ul { padding: 0; }
        .dfn-panel li { list-style: inside; }
        .dfn-panel.activated {
            display: inline-block;
            position: fixed;
            left: .5em;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - 1.5em - .4em - .5em);
            max-height: 30vh;
        }

        .dfn-paneled { cursor: pointer; }
        </style>
<style>/* style-syntax-highlighting */
pre.idl.highlight { color: #708090; }
        .highlight:not(.idl) { background: hsl(24, 20%, 95%); }
        code.highlight { padding: .1em; border-radius: .3em; }
        pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }
        .highlight .c { color: #708090 } /* Comment */
        .highlight .k { color: #990055 } /* Keyword */
        .highlight .l { color: #000000 } /* Literal */
        .highlight .n { color: #0077aa } /* Name */
        .highlight .o { color: #999999 } /* Operator */
        .highlight .p { color: #999999 } /* Punctuation */
        .highlight .cm { color: #708090 } /* Comment.Multiline */
        .highlight .cp { color: #708090 } /* Comment.Preproc */
        .highlight .c1 { color: #708090 } /* Comment.Single */
        .highlight .cs { color: #708090 } /* Comment.Special */
        .highlight .kc { color: #990055 } /* Keyword.Constant */
        .highlight .kd { color: #990055 } /* Keyword.Declaration */
        .highlight .kn { color: #990055 } /* Keyword.Namespace */
        .highlight .kp { color: #990055 } /* Keyword.Pseudo */
        .highlight .kr { color: #990055 } /* Keyword.Reserved */
        .highlight .kt { color: #990055 } /* Keyword.Type */
        .highlight .ld { color: #000000 } /* Literal.Date */
        .highlight .m { color: #000000 } /* Literal.Number */
        .highlight .s { color: #a67f59 } /* Literal.String */
        .highlight .na { color: #0077aa } /* Name.Attribute */
        .highlight .nc { color: #0077aa } /* Name.Class */
        .highlight .no { color: #0077aa } /* Name.Constant */
        .highlight .nd { color: #0077aa } /* Name.Decorator */
        .highlight .ni { color: #0077aa } /* Name.Entity */
        .highlight .ne { color: #0077aa } /* Name.Exception */
        .highlight .nf { color: #0077aa } /* Name.Function */
        .highlight .nl { color: #0077aa } /* Name.Label */
        .highlight .nn { color: #0077aa } /* Name.Namespace */
        .highlight .py { color: #0077aa } /* Name.Property */
        .highlight .nt { color: #669900 } /* Name.Tag */
        .highlight .nv { color: #222222 } /* Name.Variable */
        .highlight .ow { color: #999999 } /* Operator.Word */
        .highlight .mb { color: #000000 } /* Literal.Number.Bin */
        .highlight .mf { color: #000000 } /* Literal.Number.Float */
        .highlight .mh { color: #000000 } /* Literal.Number.Hex */
        .highlight .mi { color: #000000 } /* Literal.Number.Integer */
        .highlight .mo { color: #000000 } /* Literal.Number.Oct */
        .highlight .sb { color: #a67f59 } /* Literal.String.Backtick */
        .highlight .sc { color: #a67f59 } /* Literal.String.Char */
        .highlight .sd { color: #a67f59 } /* Literal.String.Doc */
        .highlight .s2 { color: #a67f59 } /* Literal.String.Double */
        .highlight .se { color: #a67f59 } /* Literal.String.Escape */
        .highlight .sh { color: #a67f59 } /* Literal.String.Heredoc */
        .highlight .si { color: #a67f59 } /* Literal.String.Interpol */
        .highlight .sx { color: #a67f59 } /* Literal.String.Other */
        .highlight .sr { color: #a67f59 } /* Literal.String.Regex */
        .highlight .s1 { color: #a67f59 } /* Literal.String.Single */
        .highlight .ss { color: #a67f59 } /* Literal.String.Symbol */
        .highlight .vc { color: #0077aa } /* Name.Variable.Class */
        .highlight .vg { color: #0077aa } /* Name.Variable.Global */
        .highlight .vi { color: #0077aa } /* Name.Variable.Instance */
        .highlight .il { color: #000000 } /* Literal.Number.Integer.Long */
        </style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"></p>
   <h1 class="p-name no-ref" id="title">Origin Policy</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">A Collection of Interesting Ideas, <time class="dt-updated" datetime="2016-07-28">28 July 2016</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://mikewest.github.io/origin-policy/">https://mikewest.github.io/origin-policy/</a>
     <dt class="editor">Editor:
     <dd class="editor p-author h-card vcard" data-editor-id="56384"><a class="p-name fn u-email email" href="mailto:mkwst@google.com">Mike West</a> (<span class="p-org org">Google Inc.</span>)
     <dt>Participate:
     <dd><span><a href="https://discourse.wicg.io/t/proposal-set-origin-wide-policies-via-a-manifest/1617">Discuss in the WICG</a>. <a href="https://github.com/mikewest/origin-policy/issues/new">File an issue</a> (<a href="https://github.com/mikewest/origin-policy/issues">open issues</a>)</span>
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright">©2016 Google, Inc.</p>
   <hr title="Separator for header">
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
  <div class="p-summary" data-fill-with="abstract">
   <p>This specification defines a delivery mechanism for a number of policies

which are to be applied to an entire origin. It compliments header-based
delivery mechanisms for existing policies (Content Security Policy,
Referrer Policy, etc).</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
     <ol class="toc">
      <li><a href="#examples"><span class="secno">1.1</span> <span class="content">Examples</span></a>
     </ol>
    <li>
     <a href="#framework"><span class="secno">2</span> <span class="content">Framework</span></a>
     <ol class="toc">
      <li><a href="#concepts"><span class="secno">2.1</span> <span class="content">Concepts</span></a>
      <li><a href="#origin-policy-header"><span class="secno">2.2</span> <span class="content">The <code>Origin-Policy</code> HTTP Header Field</span></a>
      <li>
       <a href="#manifest-file"><span class="secno">2.3</span> <span class="content">The Origin Policy Manifest File</span></a>
       <ol class="toc">
        <li><a href="#origin-policy-well-known"><span class="secno">2.3.1</span> <span class="content">The <code>origin-policy</code> well-known location</span></a>
        <li><a href="#headers-member"><span class="secno">2.3.2</span> <span class="content">The <code>headers</code> member</span></a>
        <li>
         <a href="#cors-preflight-member"><span class="secno">2.3.3</span> <span class="content">The <code>cors-preflight</code> and <code>unsafe-cors-preflight-with-credentials</code> members</span></a>
         <ol class="toc">
          <li><a href="#cors-examples"><span class="secno">2.3.3.1</span> <span class="content">Examples</span></a>
         </ol>
        <li><a href="#syntax"><span class="secno">2.3.4</span> <span class="content">Syntax</span></a>
       </ol>
     </ol>
    <li>
     <a href="#algorithms"><span class="secno">3</span> <span class="content">Algorithms</span></a>
     <ol class="toc">
      <li><a href="#version-for-origin"><span class="secno">3.1</span> <span class="content"> Retrieve <var>origin</var>’s manifest version. </span></a>
      <li><a href="#evict-for-origin"><span class="secno">3.2</span> <span class="content"> Evict <var>origin</var>’s cached manifest. </span></a>
      <li>
       <a href="#monkey-patching-html"><span class="secno">3.3</span> <span class="content">HTML Integration</span></a>
       <ol class="toc">
        <li><a href="#html-apply-policy"><span class="secno">3.3.1</span> <span class="content"> Apply Origin Policy to <var>settings</var>. </span></a>
       </ol>
      <li>
       <a href="#monkey-patching-fetch"><span class="secno">3.4</span> <span class="content">Fetch Integration</span></a>
       <ol class="toc">
        <li><a href="#fetch-prepare-request"><span class="secno">3.4.1</span> <span class="content"> Prepare <var>request</var> with Origin Policy. </span></a>
        <li><a href="#fetch-parse-response"><span class="secno">3.4.2</span> <span class="content"> Process <var>response</var> for Origin Policy. </span></a>
        <li><a href="#fetch-apply-policy"><span class="secno">3.4.3</span> <span class="content"> Apply an Origin Policy to <var>response</var>. </span></a>
        <li><a href="#fetch-bypass-preflight"><span class="secno">3.4.4</span> <span class="content"> Does Origin Policy bypass <var>request</var>’s CORS-preflight request? </span></a>
       </ol>
     </ol>
    <li>
     <a href="#specification"><span class="secno">4</span> <span class="content">Specification Considerations</span></a>
     <ol class="toc">
      <li><a href="#app-manifest"><span class="secno">4.1</span> <span class="content">Relation to Web App Manifests</span></a>
      <li><a href="#why-well-known"><span class="secno">4.2</span> <span class="content">Why <code>.well-known</code>?</span></a>
     </ol>
    <li>
     <a href="#authoring"><span class="secno">5</span> <span class="content">Authoring Considerations</span></a>
     <ol class="toc">
      <li><a href="#headers-to-set"><span class="secno">5.1</span> <span class="content">Headers To Set</span></a>
      <li><a href="#perf"><span class="secno">5.2</span> <span class="content">Performance</span></a>
      <li><a href="#server-push"><span class="secno">5.3</span> <span class="content">Server Push</span></a>
      <li><a href="#strict-dynamic"><span class="secno">5.4</span> <span class="content">CSP: Nonces and <code>'strict-dynamic'</code></span></a>
     </ol>
    <li><a href="#privacy-and-security"><span class="secno">6</span> <span class="content">Privacy and Security Considerations</span></a>
    <li>
     <a href="#iana"><span class="secno">7</span> <span class="content">IANA Considerations</span></a>
     <ol class="toc">
      <li><a href="#iana-header"><span class="secno">7.1</span> <span class="content">The <code>Origin-Policy</code> header</span></a>
      <li><a href="#iana-well-known"><span class="secno">7.2</span> <span class="content">Creation of the well-known location <code>origin-policy</code></span></a>
     </ol>
    <li><a href="#ack"><span class="secno">8</span> <span class="content">Acknowledgements</span></a>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p>Developers set a number of properties associated with resources on an origin
by delivering resource-specific HTTP response headers and <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/semantics.html#meta">meta</a></code> elements.
This is becoming more common over time, and it’s quite normal these days to see
multiple kilobytes at the beginning of every response dedicated to such
metadata. Setting this metadata is valuable indeed, as it can have a large
impact on performance, security, and privacy.</p>
   <p>However, the existing delivery mechanism is ill-suited to the task, suffering
from a clear mismatch between the resource-specific nature of the metadata
declarations on the one hand, and the origin-wide intent of the metadata on the
other. Take <code>Strict-Transport-Security</code> <a data-link-type="biblio" href="#biblio-rfc6797">[RFC6797]</a> and <code>Public-Key-Pins</code> <a data-link-type="biblio" href="#biblio-rfc7469">[RFC7469]</a>, for example, which explicitly alter the state of an entire origin,
but are delivered in resource-specific response headers.</p>
   <p>Moreover, many resource-specific headers are deployed in such a way as to be <i lang="la">de facto</i> static across all resources that an origin serves. <code>Content-Security-Policy</code> <a data-link-type="biblio" href="#biblio-csp3">[CSP3]</a>, for instance, can be very granular indeed,
but is commonly implemented by setting a single policy which is delivered for
an entire application.</p>
   <p>A number of implications follow:</p>
   <ol>
    <li data-md="">
     <p>Servers are required to repeat themselves. At length. <code>Content-Security-Policy</code> alone can easily eat multiple kilobytes of each
  navigational response, bandwidth which could instead be dedicated to content
  a user might care about. This has obvious and direct impact on the delay a
  user experiences when navigating, but has less obvious knock-on effects that
  reduce performance further. HTTP/2’s HPACK <a data-link-type="biblio" href="#biblio-rfc7541">[RFC7541]</a> header compression
  is limited to ~4k of state for processing, for instance, meaning that these
  verbose headers can greatly reduce its effectiveness</p>
    <li data-md="">
     <p>Servers are required to repeat themselves. Unerringly. When policy applies
  strictly to a resource, and not to the origin, then a server must send that
  policy down with every response. If the developer forgets a page (which is
  actually a very common occurence: when’s the last time you thought about
  your 404 error page? How about your 417? Or 505?), then the policy’s
  protections don’t apply to that resource, leaving an exploitable hole.</p>
   </ol>
   <p>This document introduces a new delivery mechanism for policies which are meant
to apply to an entire origin. In short, a server will provide an <a data-link-type="dfn" href="#origin-policy-manifest" id="ref-for-origin-policy-manifest-1">Origin
Policy Manifest</a> file at a well-known location. This file contains all of the
metadata the server would like to set for each response. User agents can be
instructed to synchronously download and process this manifest before completing
a navigation to an origin’s resources, ensuring that the policy contained therin
will be safely applied to each resource, and allowing the server to skip the
overhead of including the relevant headers with each response. Typically, the
server can speed things up even more by using HTTP/2 Server Push (<a data-link-type="biblio" href="#biblio-rfc7540">[RFC7540]</a>,
section 8.2) to proactively send the manifest file along with the response to
the user agent’s first request.</p>
   <h3 class="heading settled" data-level="1.1" id="examples"><span class="secno">1.1. </span><span class="content">Examples</span><a class="self-link" href="#examples"></a></h3>
   <div class="example" id="example-b20f4848">
    <a class="self-link" href="#example-b20f4848"></a> MegaCorp, Inc. wishes to ensure that a baseline content security policy is
applied to each of the pages on <code>https://example.com</code>, while avoiding the
overhead associated with large response headers, and the uncertainty that
they’ve really covered everything that lives on the origin. 
    <p>When they see a request come in that contains a <a data-link-type="dfn" href="#origin-policy" id="ref-for-origin-policy-1"><code>Origin-Policy</code></a> header, they can respond in kind, pointing the client to a manifest file
in a well-known location on their server. That is, given the following
request:</p>
<pre>GET / HTTP/1.1
Host: example.com
Connection: keep-alive
...
<a data-link-type="dfn" href="#origin-policy" id="ref-for-origin-policy-2">Origin-Policy</a>: 1
...
</pre>
    <p>MegaCorp, Inc. can respond with:</p>
<pre>HTTP/1.1 200 OK
Content-Encoding: gzip
Accept-Ranges: bytes
Cache-Control: max-age=604800
Content-Type: text/html
...
<a data-link-type="dfn" href="#origin-policy" id="ref-for-origin-policy-3">Origin-Policy</a>: "policy-1"
...
</pre>
    <p>The client will parse the response headers, and synchronously request <code>https://example.com/.well-known/origin-policy/policy-1</code> before completing
the navigation. The policies contained in that file will be cached
according to the normal HTTP caching rules, and applied to pages on <code>https://example.com/</code> (including the current navigation).</p>
<pre>{
  "<a data-link-type="dfn" href="#headers" id="ref-for-headers-1">headers</a>": [
    {
      "<a data-link-type="idl" href="#dom-httpheader-name" id="ref-for-dom-httpheader-name-1">name</a>": "<a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#header-content-security-policy">Content-Security-Policy</a>",
      "<a data-link-type="idl" href="#dom-httpheader-value" id="ref-for-dom-httpheader-value-1">value</a>": "<a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#script-src">script-src</a> 'self' https://cdn.example.com",
      "<a data-link-type="idl" href="#dom-httpheader-type" id="ref-for-dom-httpheader-type-1">type</a>": "<a data-link-type="idl" href="#dom-httpheadertype-fallback" id="ref-for-dom-httpheadertype-fallback-1">fallback</a>"
    },
    {
      "<a data-link-type="idl" href="#dom-httpheader-name" id="ref-for-dom-httpheader-name-2">name</a>": "<a data-link-type="dfn" href="https://w3c.github.io/webappsec-referrer-policy/#referrer-policy-header">Referrer-Policy</a>",
      "<a data-link-type="idl" href="#dom-httpheader-value" id="ref-for-dom-httpheader-value-2">value</a>": "origin-when-cross-origin",
      "<a data-link-type="idl" href="#dom-httpheader-type" id="ref-for-dom-httpheader-type-2">type</a>": "<a data-link-type="idl" href="#dom-httpheadertype-fallback" id="ref-for-dom-httpheadertype-fallback-2">fallback</a>"
    }
    {
      "<a data-link-type="idl" href="#dom-httpheader-name" id="ref-for-dom-httpheader-name-3">name</a>": "<a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#header-content-security-policy">Content-Security-Policy</a>",
      "<a data-link-type="idl" href="#dom-httpheader-value" id="ref-for-dom-httpheader-value-3">value</a>": "<a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#object-src">object-src</a> 'none'; <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#frame-ancestors">frame-ancestors</a> 'none'",
      "<a data-link-type="idl" href="#dom-httpheader-type" id="ref-for-dom-httpheader-type-3">type</a>": "<a data-link-type="idl" href="#dom-httpheadertype-baseline" id="ref-for-dom-httpheadertype-baseline-1">baseline</a>"
    },
    {
      "<a data-link-type="idl" href="#dom-httpheader-name" id="ref-for-dom-httpheader-name-4">name</a>": "<a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6797#section-8.1">Strict-Transport-Security</a>",
      "<a data-link-type="idl" href="#dom-httpheader-value" id="ref-for-dom-httpheader-value-4">value</a>": "max-age=10886400; includeSubDomains; preload",
      "<a data-link-type="idl" href="#dom-httpheader-type" id="ref-for-dom-httpheader-type-4">type</a>": "<a data-link-type="idl" href="#dom-httpheadertype-baseline" id="ref-for-dom-httpheadertype-baseline-2">baseline</a>"
    },
    {
      "<a data-link-type="idl" href="#dom-httpheader-name" id="ref-for-dom-httpheader-name-5">name</a>": "<a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#x-content-type-options-header">X-Content-Type-Options</a>",
      "<a data-link-type="idl" href="#dom-httpheader-value" id="ref-for-dom-httpheader-value-5">value</a>": "nosniff",
      "<a data-link-type="idl" href="#dom-httpheader-type" id="ref-for-dom-httpheader-type-5">type</a>": "<a data-link-type="idl" href="#dom-httpheadertype-baseline" id="ref-for-dom-httpheadertype-baseline-3">baseline</a>"
    }
  ],
  "<a data-link-type="dfn" href="#cors-preflight" id="ref-for-cors-preflight-1">cors-preflight</a>": {
    "<a data-link-type="idl" href="#dom-corsoptions-origins" id="ref-for-dom-corsoptions-origins-1">origins</a>": "*"
  }
}
</pre>
    <p class="note" role="note">Note: MegaCorp, Inc. can signficantly speed up this interaction by proactively
pushing the current manifest down to the client along with the initial response.
See <a href="#server-push">§5.3 Server Push</a> for details.</p>
   </div>
   <div class="example" id="example-f6471aa3">
    <a class="self-link" href="#example-f6471aa3"></a> MegaCorp, Inc. wishes to update the origin policy it has distributed to clients.
It can do so by setting an appropriate <code>Origin-Policy</code> header in the response.
That is, given the following request: 
<pre>GET / HTTP/1.1
Host: example.com
Connection: keep-alive
...
<a data-link-type="dfn" href="#origin-policy" id="ref-for-origin-policy-4">Origin-Policy</a>: 1
...
</pre>
    <p>MegaCorp, Inc. can respond with:</p>
<pre>HTTP/1.1 200 OK
Content-Encoding: gzip
Accept-Ranges: bytes
Cache-Control: max-age=604800
Content-Type: text/html
...
<a data-link-type="dfn" href="#origin-policy" id="ref-for-origin-policy-5">Origin-Policy</a>: "policy-2"
...
</pre>
    <p>The client will process the header, replace the <code>policy-1</code> manifest it downloaded
in the previous example with the newly specified <code>policy-2</code> manifest, and apply
the latter to the response.</p>
   </div>
   <div class="example" id="example-25a0a06c">
    <a class="self-link" href="#example-25a0a06c"></a> MegaCorp, Inc. wishes to remove the origin policy it has distributed to clients.
It can do so by setting an <code>Origin-Policy</code> header with a value of <code>0</code> in the
response: 
<pre>HTTP/1.1 200 OK
Content-Encoding: gzip
Accept-Ranges: bytes
Cache-Control: max-age=604800
Content-Type: text/html
...
<a data-link-type="dfn" href="#origin-policy" id="ref-for-origin-policy-6">Origin-Policy</a>: 0
...
</pre>
    <p>The client will process the header, and evict any origin policy for the
response’s origin.</p>
    <p class="note" role="note">Note: The manifest itself will be removed, but some of the policies it set may
still be effective. For example, if the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6797#section-8.1">Strict-Transport-Security</a> header
was set, the <code>maxage</code> property it contained may still force TLS on any connection
to the origin’s host. Those kinds of behaviors will need to be cleared
individually, as appropriate for the feature. For example, to remove HSTS, the
server could send <code>Strict-Transport-Security: maxage=0</code>.</p>
   </div>
   <h2 class="heading settled" data-level="2" id="framework"><span class="secno">2. </span><span class="content">Framework</span><a class="self-link" href="#framework"></a></h2>
   <h3 class="heading settled" data-level="2.1" id="concepts"><span class="secno">2.1. </span><span class="content">Concepts</span><a class="self-link" href="#concepts"></a></h3>
   <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="origin-policy-object">origin policy object</dfn> is a tuple of a string
(<dfn data-dfn-for="origin policy object" data-dfn-type="dfn" data-noexport="" id="origin-policy-object-version">version<a class="self-link" href="#origin-policy-object-version"></a></dfn>), and the contents of an <a data-link-type="dfn" href="#origin-policy-manifest" id="ref-for-origin-policy-manifest-2">origin policy manifest</a> (<dfn class="dfn-paneled" data-dfn-for="origin policy object" data-dfn-type="dfn" data-noexport="" id="origin-policy-object-body">body</dfn>).</p>
   <p>User agents have a <dfn class="dfn-paneled" data-dfn-type="dfn" data-export="" id="origin-policy-store">Origin Policy Store</dfn>, which is a key/value
store that constitutes a 1:1 mapping between <a data-link-type="dfn" href="#origin-policy-object" id="ref-for-origin-policy-object-1">origin policy objects</a> and <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin">origins</a>.</p>
   <p>When asked to <dfn class="dfn-paneled" data-algorithm="retrieve an Origin Policy for an origin" data-dfn-type="dfn" data-local-lt="get-policy-from-store" data-lt="retrieve an Origin Policy for an origin" data-noexport="" id="retrieve-an-origin-policy-for-an-origin">retrieve an Origin
Policy for an origin</dfn>, an <a data-link-type="dfn" href="#origin-policy-store" id="ref-for-origin-policy-store-1">Origin Policy Store</a> will return either a
single <a data-link-type="dfn" href="#origin-policy-object" id="ref-for-origin-policy-object-2">origin policy object</a> (if one is stored for the given origin), or <code>null</code> (if nothing is stored for the given origin).</p>
   <p>When asked to <dfn class="dfn-paneled" data-algorithm="evict an Origin policy for an origin" data-dfn-type="dfn" data-local-lt="evict-policy-from-store" data-lt="evict an Origin policy for an origin" data-noexport="" id="evict-an-origin-policy-for-an-origin">evict an Origin
policy for an origin</dfn>, an <a data-link-type="dfn" href="#origin-policy-store" id="ref-for-origin-policy-store-2">Origin Policy Store</a> will discard any <a data-link-type="dfn" href="#origin-policy-object" id="ref-for-origin-policy-object-3">origin policy object</a> associated with the given origin.</p>
   <h3 class="heading settled" data-level="2.2" id="origin-policy-header"><span class="secno">2.2. </span><span class="content">The <code>Origin-Policy</code> HTTP Header Field</span><a class="self-link" href="#origin-policy-header"></a></h3>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-export="" id="origin-policy"><code>Origin-Policy</code></dfn> HTTP header field is sent with
navigational HTTP requests in order to advertise support generally for the
origin policy manifest mechanism defined in this document. Its value
MUST be <code>1</code>.</p>
   <p>The same header is sent by the server in responses to such requests to
inform the client that a origin policy manifest is available to fetch. Its
value MUST be either <code>0</code> or a base64-encoded value, wrapped in double-quotes.
The following ABNF defines that more formally:</p>
<pre class="abnf">Origin-Policy: 0 / 1 / <a data-link-type="grammar" href="#grammardef-manifest-name" id="ref-for-grammardef-manifest-name-1">manifest-name</a>
<dfn class="dfn-paneled" data-dfn-type="grammar" data-export="" id="grammardef-manifest-name">manifest-name</dfn>: <a data-link-type="grammar" href="https://tools.ietf.org/html/rfc5234#appendix-B.1">DQUOTE</a> <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-base64-value">base64-value</a> <a data-link-type="grammar" href="https://tools.ietf.org/html/rfc5234#appendix-B.1">DQUOTE</a>
; base64-value is defined in [[!CSP3]]
; DQUOTE is defined in [[!RFC5234]]
</pre>
   <p>This header MUST be ignored if <a href="https://w3c.github.io/webappsec-secure-contexts/#is-url-trustworthy">Secure Contexts §is-url-trustworthy</a> returns
"<code>Not Trustworthy</code>" when executed upon the response’s URL.</p>
   <h3 class="heading settled" data-level="2.3" id="manifest-file"><span class="secno">2.3. </span><span class="content">The Origin Policy Manifest File</span><a class="self-link" href="#manifest-file"></a></h3>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-export="" data-local-lt="manifest" id="origin-policy-manifest">Origin Policy Manifest</dfn> is a
JSON-formatted document consisting of a top-level object with one or more
members. Each member defines a specific aspect of an origin’s policy.</p>
<pre class="example" id="example-b41b52ca"><a class="self-link" href="#example-b41b52ca"></a>{
  "<a data-link-type="dfn" href="#headers" id="ref-for-headers-2">headers</a>": [
    {
      "<a data-link-type="idl" href="#dom-httpheader-name" id="ref-for-dom-httpheader-name-6">name</a>": "<a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#header-content-security-policy">Content-Security-Policy</a>",
      "<a data-link-type="idl" href="#dom-httpheader-value" id="ref-for-dom-httpheader-value-6">value</a>": "<a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#script-src">script-src</a> 'self' https://cdn.example.com",
      "<a data-link-type="idl" href="#dom-httpheader-type" id="ref-for-dom-httpheader-type-6">type</a>": "<a data-link-type="idl" href="#dom-httpheadertype-fallback" id="ref-for-dom-httpheadertype-fallback-3">fallback</a>"
    },
    {
      "<a data-link-type="idl" href="#dom-httpheader-name" id="ref-for-dom-httpheader-name-7">name</a>": "<a data-link-type="dfn" href="https://w3c.github.io/webappsec-referrer-policy/#referrer-policy-header">Referrer-Policy</a>",
      "<a data-link-type="idl" href="#dom-httpheader-value" id="ref-for-dom-httpheader-value-7">value</a>": "origin-when-cross-origin",
      "<a data-link-type="idl" href="#dom-httpheader-type" id="ref-for-dom-httpheader-type-7">type</a>": "<a data-link-type="idl" href="#dom-httpheadertype-fallback" id="ref-for-dom-httpheadertype-fallback-4">fallback</a>"
    }
    {
      "<a data-link-type="idl" href="#dom-httpheader-name" id="ref-for-dom-httpheader-name-8">name</a>": "<a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#header-content-security-policy">Content-Security-Policy</a>",
      "<a data-link-type="idl" href="#dom-httpheader-value" id="ref-for-dom-httpheader-value-8">value</a>": "<a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#object-src">object-src</a> 'none'; <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#frame-ancestors">frame-ancestors</a> 'none'",
      "<a data-link-type="idl" href="#dom-httpheader-type" id="ref-for-dom-httpheader-type-8">type</a>": "<a data-link-type="idl" href="#dom-httpheadertype-baseline" id="ref-for-dom-httpheadertype-baseline-4">baseline</a>"
    },
    {
      "<a data-link-type="idl" href="#dom-httpheader-name" id="ref-for-dom-httpheader-name-9">name</a>": "<a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6797#section-8.1">Strict-Transport-Security</a>",
      "<a data-link-type="idl" href="#dom-httpheader-value" id="ref-for-dom-httpheader-value-9">value</a>": "max-age=10886400; includeSubDomains; preload",
      "<a data-link-type="idl" href="#dom-httpheader-type" id="ref-for-dom-httpheader-type-9">type</a>": "<a data-link-type="idl" href="#dom-httpheadertype-baseline" id="ref-for-dom-httpheadertype-baseline-5">baseline</a>"
    },
    {
      "<a data-link-type="idl" href="#dom-httpheader-name" id="ref-for-dom-httpheader-name-10">name</a>": "<a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#x-content-type-options-header">X-Content-Type-Options</a>",
      "<a data-link-type="idl" href="#dom-httpheader-value" id="ref-for-dom-httpheader-value-10">value</a>": "nosniff",
      "<a data-link-type="idl" href="#dom-httpheader-type" id="ref-for-dom-httpheader-type-10">type</a>": "<a data-link-type="idl" href="#dom-httpheadertype-baseline" id="ref-for-dom-httpheadertype-baseline-6">baseline</a>"
    }
  ],
  "<a data-link-type="dfn" href="#cors-preflight" id="ref-for-cors-preflight-2">cors-preflight</a>": {
    "<a data-link-type="idl" href="#dom-corsoptions-origins" id="ref-for-dom-corsoptions-origins-2">origins</a>": "*"
  }
}
</pre>
   <h4 class="heading settled" data-level="2.3.1" id="origin-policy-well-known"><span class="secno">2.3.1. </span><span class="content">The <code>origin-policy</code> well-known location</span><a class="self-link" href="#origin-policy-well-known"></a></h4>
   <p><a data-link-type="dfn" href="#origin-policy-manifest" id="ref-for-origin-policy-manifest-3">Origin Policy Manifest</a> files for a given origin MUST be located as
suffixes to the well-known location <code>/.well-known/origin-policy</code> <a data-link-type="biblio" href="#biblio-rfc5785">[RFC5785]</a>.
Their names MUST be strings of characters matching the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-base64-value">base64-value</a> grammar. That is, <code>/.well-known/origin-policy/a</code> might point to one <a data-link-type="dfn" href="#origin-policy-manifest" id="ref-for-origin-policy-manifest-4">Origin Policy Manifest</a> file, while <code>/.well-known/origin-policy/b</code> might point to another.</p>
   <p>Servers MUST respond to a <code>GET</code> request to <code>/.well-known/origin-policy</code> with a
302 redirect whose <code>Location</code> header points to the origin’s current <a data-link-type="dfn" href="#origin-policy-manifest" id="ref-for-origin-policy-manifest-5">Origin
Policy Manifest</a>, or with a 404 response if no such policy is available.</p>
   <p class="note" role="note">Note: This redirect can be used as a discovery mechanism. User agents might
prefetch such manifest files for origins a user is likely to visit, testing
services might give developers automated feedback on their origin’s manifest,
etc.</p>
   <h4 class="heading settled" data-level="2.3.2" id="headers-member"><span class="secno">2.3.2. </span><span class="content">The <code>headers</code> member</span><a class="self-link" href="#headers-member"></a></h4>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-export="" id="headers"><code>headers</code></dfn> member defines a set of HTTP response headers
which will be automatically appended to resources delivered from the manifest’s
origin. The headers specified in this member’s value are categorized either as <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="baseline-headers">baseline headers</dfn> which appended to <em>every</em> resource served by
the origin, or as <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="fallback-headers">fallback headers</dfn> which are appended only to those
resources which don’t themselves deliver the header.</p>
   <p>The <code>headers</code> member’s value MUST be a sequence of <code class="idl"><a data-link-type="idl" href="#dictdef-httpheader" id="ref-for-dictdef-httpheader-1">HTTPHeader</a></code> dictionaries,
each containing the following members:</p>
   <dl>
    <dt data-md="">
     <p><dfn class="dfn-paneled idl-code" data-dfn-for="HTTPHeader" data-dfn-type="dict-member" data-export="" id="dom-httpheader-name">name</dfn>, <span> of type <a data-link-type="idl-name" href="https://heycam.github.io/webidl/#dom-USVString">USVString</a></span></p>
    <dd data-md="">
     <p>A string representing the header’s name: "<code>Content-Security-Policy</code>", for
  example. This member is required.</p>
    <dt data-md="">
     <p><dfn class="dfn-paneled idl-code" data-dfn-for="HTTPHeader" data-dfn-type="dict-member" data-export="" id="dom-httpheader-value">value</dfn>, <span> of type <a data-link-type="idl-name" href="https://heycam.github.io/webidl/#dom-USVString">USVString</a></span></p>
    <dd data-md="">
     <p>A string representing the header’s value: "script-src 'none'", for example.
  This member is required.</p>
    <dt data-md="">
     <p><dfn class="dfn-paneled idl-code" data-dfn-for="HTTPHeader" data-dfn-type="dict-member" data-export="" id="dom-httpheader-type">type</dfn>, <span> of type <a data-link-type="idl-name" href="#enumdef-httpheadertype" id="ref-for-enumdef-httpheadertype-1">HTTPHeaderType</a>, defaulting to <code>"baseline"</code></span></p>
    <dd data-md="">
     <p>Either "<dfn class="dfn-paneled idl-code" data-dfn-for="HTTPHeaderType" data-dfn-type="enum-value" data-export="" id="dom-httpheadertype-baseline"><code>baseline</code></dfn>" or
  "<dfn class="dfn-paneled idl-code" data-dfn-for="HTTPHeaderType" data-dfn-type="enum-value" data-export="" id="dom-httpheadertype-fallback"><code>fallback</code></dfn>", designating this header as
  either a <a data-link-type="dfn" href="#baseline-headers" id="ref-for-baseline-headers-1">baseline header</a> or <a data-link-type="dfn" href="#fallback-headers" id="ref-for-fallback-headers-1">fallback header</a> respectively. If
  this member is not explicitly present, it defaults to "<code>baseline</code>".</p>
   </dl>
   <p>Members other than those specified here will be ignored, and will not cause
parse failures.</p>
   <p class="issue" id="issue-a997f997"><a class="self-link" href="#issue-a997f997"></a> It may be a dangerous (or at least confusing) footgun to allow certain
headers to be set on an origin (consider <code>Content-Type</code> or <code>Content-Length</code>,
for instance). Perhaps it would be reasonable to limit the <a data-link-type="dfn" href="#headers" id="ref-for-headers-3"><code>headers</code></a> member to some whitelist of expected headers?</p>
   <h4 class="heading settled" data-level="2.3.3" id="cors-preflight-member"><span class="secno">2.3.3. </span><span class="content">The <code>cors-preflight</code> and <code>unsafe-cors-preflight-with-credentials</code> members</span><a class="self-link" href="#cors-preflight-member"></a></h4>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-export="" id="cors-preflight"><code>cors-preflight</code></dfn> and <dfn class="dfn-paneled" data-dfn-type="dfn" data-export="" id="unsafe-cors-preflight-with-credentials"><code>unsafe-cors-preflight-with-credentials</code></dfn> members assert that
an origin understands the CORS protocol, and that the user agent can therefore
assume success for certain types of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#cors-preflight-request">CORS-preflight requests</a>. The former
governs uncredentialed requests, the latter credentialed.</p>
   <p>Both members values MUST be a <code class="idl"><a data-link-type="idl" href="#dictdef-corsoptions" id="ref-for-dictdef-corsoptions-1">CORSOptions</a></code> dictionary, with the following
members:</p>
   <dl>
    <dt data-md="">
     <p><dfn class="dfn-paneled idl-code" data-dfn-for="CORSOptions" data-dfn-type="dict-member" data-export="" id="dom-corsoptions-origins">origins</dfn>, <span> of type <a data-link-type="idl-name" href="#typedefdef-corsoptionlist" id="ref-for-typedefdef-corsoptionlist-1">CORSOptionList</a></span></p>
    <dd data-md="">
     <p>Either the string "<dfn class="dfn-paneled idl-code" data-dfn-for="Wildcard" data-dfn-type="enum-value" data-export="" id="dom-wildcard"><code>*</code></dfn>" or a sequence
  of strings, representing the origins for which <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#cors-preflight-request">CORS-preflight
  requests</a> may be bypassed. This member is required.</p>
     <p>If this is a member of <a data-link-type="dfn" href="#unsafe-cors-preflight-with-credentials" id="ref-for-unsafe-cors-preflight-with-credentials-1"><code>unsafe-cors-preflight-with-credentials</code></a>, then
  its value MUST not be "<code class="idl"><a data-link-type="idl" href="#dom-wildcard" id="ref-for-dom-wildcard-1">*</a></code>".</p>
    <dt data-md="">
     <p><dfn class="dfn-paneled idl-code" data-dfn-for="CORSOptions" data-dfn-type="dict-member" data-export="" id="dom-corsoptions-methods">methods</dfn>, <span> of type <a data-link-type="idl-name" href="#typedefdef-corsoptionlist" id="ref-for-typedefdef-corsoptionlist-2">CORSOptionList</a>, nullable</span></p>
    <dd data-md="">
     <p>Either the string "<code class="idl"><a data-link-type="idl" href="#dom-wildcard" id="ref-for-dom-wildcard-2">*</a></code>" or a sequence
  of strings, representing the non-<a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#cors-safelisted-method">CORS-safelisted method</a> <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-method">methods</a> for which <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#cors-preflight-request">CORS-preflight request</a> may
  be bypassed. This member is optional.</p>
     <p>If this is a member of <a data-link-type="dfn" href="#unsafe-cors-preflight-with-credentials" id="ref-for-unsafe-cors-preflight-with-credentials-2"><code>unsafe-cors-preflight-with-credentials</code></a>, then
  its value MUST not be "<code class="idl"><a data-link-type="idl" href="#dom-wildcard" id="ref-for-dom-wildcard-3">*</a></code>".</p>
    <dt data-md="">
     <p><dfn class="dfn-paneled idl-code" data-dfn-for="CORSOptions" data-dfn-type="dict-member" data-export="" id="dom-corsoptions-headers">headers</dfn>, <span> of type <a data-link-type="idl-name" href="#typedefdef-corsoptionlist" id="ref-for-typedefdef-corsoptionlist-3">CORSOptionList</a>, nullable</span></p>
    <dd data-md="">
     <p>Either the string "<code class="idl"><a data-link-type="idl" href="#dom-wildcard" id="ref-for-dom-wildcard-4">*</a></code>" or a sequence
  of strings, representing the non-<a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#cors-safelisted-request-header">CORS-safelisted request-header</a> <a data-link-type="dfn" href="#headers" id="ref-for-headers-4">headers</a> which <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#cors-preflight-request">CORS-preflight request</a> may be bypassed. This
  member is optional.</p>
     <p>If this is a member of <a data-link-type="dfn" href="#unsafe-cors-preflight-with-credentials" id="ref-for-unsafe-cors-preflight-with-credentials-3"><code>unsafe-cors-preflight-with-credentials</code></a>, then
  its value MUST not be "<code class="idl"><a data-link-type="idl" href="#dom-wildcard" id="ref-for-dom-wildcard-5">*</a></code>".</p>
   </dl>
   <p class="note" role="note">Note: This member does <em>not</em> set CORS headers for responses in general;
it only allows the user agent to skip the <code>OPTIONS</code> preflight request for a
defined set of requests.</p>
   <h5 class="heading settled" data-level="2.3.3.1" id="cors-examples"><span class="secno">2.3.3.1. </span><span class="content">Examples</span><a class="self-link" href="#cors-examples"></a></h5>
   <div class="example" id="example-f4ec8015">
    <a class="self-link" href="#example-f4ec8015"></a> MegaCorp, Inc. has a partnership with Excellent Examples, GmbH., and wishes to
  allow the latter to make otherwise unsafely credentialed cross-origin requests
  without the overhead of CORS preflight requests. They can do so with the
  following manifest: 
<pre>{
  "<a data-link-type="dfn" href="#unsafe-cors-preflight-with-credentials" id="ref-for-unsafe-cors-preflight-with-credentials-4">unsafe-cors-preflight-with-credentials</a>": {
    "<a data-link-type="idl" href="#dom-corsoptions-origins" id="ref-for-dom-corsoptions-origins-3">origins</a>": [ "https://excellent-example.test/" ]
  }
}
</pre>
    <p>As spelled out in <a href="#fetch-bypass-preflight" id="ref-for-fetch-bypass-preflight-1">§3.4.4 Does Origin Policy bypass request’s CORS-preflight request?</a>, this bypasses <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#cors-preflight-request">CORS-preflight
  requests</a> for credentialed requests coming from <code>https://excellent-example.text</code>, as long as they don’t set strange headers,
  or use strange HTTP methods.</p>
    <p>If the API required a special header (say <code>X-Examples-Are-Excellent</code>), or a
  custom HTTP method (say <code>EXAMPLE</code>), MegaCorp, Inc. could bypass preflights
  for those as well by changing their manifest as follows:</p>
<pre>{
  "<a data-link-type="dfn" href="#unsafe-cors-preflight-with-credentials" id="ref-for-unsafe-cors-preflight-with-credentials-5">unsafe-cors-preflight-with-credentials</a>": {
    "<a data-link-type="idl" href="#dom-corsoptions-origins" id="ref-for-dom-corsoptions-origins-4">origins</a>": [ "https://excellent-example.test/" ],
    "<a data-link-type="idl" href="#dom-corsoptions-methods" id="ref-for-dom-corsoptions-methods-1">methods</a>": [ "EXAMPLE" ],
    "<a data-link-type="idl" href="#dom-corsoptions-headers" id="ref-for-dom-corsoptions-headers-1">headers</a>": [ "X-Examples-Are-Excellent" ]
  }
}
</pre>
   </div>
   <div class="example" id="example-52986ffc">
    <a class="self-link" href="#example-52986ffc"></a> MegaCorp, Inc. is a staunch advocate of open data, and wishes to make all of
  the API endpoints on <code>https://open.example.com/</code> available for uncredentialed
  requests from any origin. They can do so with the following manifest: 
<pre>{
  "<a data-link-type="dfn" href="#headers" id="ref-for-headers-5">headers</a>": [
    {
      "<a data-link-type="idl" href="#dom-httpheader-name" id="ref-for-dom-httpheader-name-11">name</a>": "Access-Control-Allow-Origin",
      "<a data-link-type="idl" href="#dom-httpheader-value" id="ref-for-dom-httpheader-value-11">value</a>": "*",
      "<a data-link-type="idl" href="#dom-httpheader-type" id="ref-for-dom-httpheader-type-11">type</a>": "<a class="idl-code" data-link-type="enum-value" href="#dom-httpheadertype-fallback" id="ref-for-dom-httpheadertype-fallback-5">fallback</a>"
    }
  ],
  "<a data-link-type="dfn" href="#cors-preflight" id="ref-for-cors-preflight-3">cors-preflight</a>": {
    "<a data-link-type="idl" href="#dom-corsoptions-origins" id="ref-for-dom-corsoptions-origins-5">origins</a>": "*"
  }
}
</pre>
    <p>As spelled out in <a href="#fetch-bypass-preflight" id="ref-for-fetch-bypass-preflight-2">§3.4.4 Does Origin Policy bypass request’s CORS-preflight request?</a>, this bypasses <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#cors-preflight-request">CORS-preflight
  requests</a> for uncredentialed requests from any origin. Further, it appends
  an <code>Access-Control-Allow-Origin: *</code> header to each response that doesn’t set
  a custom value for that header.</p>
    <p class="note" role="note">Note: This doesn’t allow anything more than the "<a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#basic-safe-cors-protocol-setup">Basic safe CORS
  protocol setup</a>", as <code>*</code> will not allow credentialed access to any resource
  and the static manifest cannot be configured to echo the actual origin of the
  requestor.</p>
   </div>
   <h4 class="heading settled" data-level="2.3.4" id="syntax"><span class="secno">2.3.4. </span><span class="content">Syntax</span><a class="self-link" href="#syntax"></a></h4>
<pre class="idl highlight def">//
// header member:
//
<span class="kt">enum</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="enum" data-export="" id="enumdef-httpheadertype">HTTPHeaderType</dfn> { <a class="s idl-code" data-link-type="enum-value" href="#dom-httpheadertype-baseline" id="ref-for-dom-httpheadertype-baseline-7">"baseline"</a>, <a class="s idl-code" data-link-type="enum-value" href="#dom-httpheadertype-fallback" id="ref-for-dom-httpheadertype-fallback-6">"fallback"</a> };

<span class="kt">dictionary</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="dictionary" data-export="" id="dictdef-httpheader">HTTPHeader</dfn> {
  <span class="kt">required</span> <span class="kt">USVString</span> <a class="nv idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-httpheader-name" id="ref-for-dom-httpheader-name-12">name</a>;
  <span class="kt">required</span> <span class="kt">USVString</span> <a class="nv idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-httpheader-value" id="ref-for-dom-httpheader-value-12">value</a>;
  <a class="n" data-link-type="idl-name" href="#enumdef-httpheadertype" id="ref-for-enumdef-httpheadertype-2">HTTPHeaderType</a> <a class="nv idl-code" data-default="&quot;baseline&quot;" data-link-type="dict-member" data-type="HTTPHeaderType " href="#dom-httpheader-type" id="ref-for-dom-httpheader-type-12">type</a> = "baseline";
};


//
// cors-preflight and unsafe-cors-preflight-with-credentials
//
<span class="kt">enum</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="enum" data-export="" id="enumdef-wildcard">Wildcard</dfn> { <a class="s idl-code" data-link-type="enum-value" href="#dom-wildcard" id="ref-for-dom-wildcard-6">"*"</a> };
<span class="kt">typedef</span> (<a class="n" data-link-type="idl-name" href="#enumdef-wildcard" id="ref-for-enumdef-wildcard-1">Wildcard</a> <span class="kt">or</span> <span class="kt">sequence</span>&lt;<span class="kt">USVString</span>>) <dfn class="nv dfn-paneled idl-code" data-dfn-type="typedef" data-export="" id="typedefdef-corsoptionlist">CORSOptionList</dfn>;

<span class="kt">dictionary</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="dictionary" data-export="" id="dictdef-corsoptions">CORSOptions</dfn> {
  <a class="n" data-link-type="idl-name" href="#typedefdef-corsoptionlist" id="ref-for-typedefdef-corsoptionlist-4">CORSOptionList</a> <a class="nv idl-code" data-link-type="dict-member" data-type="CORSOptionList " href="#dom-corsoptions-origins" id="ref-for-dom-corsoptions-origins-6">origins</a>;
  <a class="n" data-link-type="idl-name" href="#typedefdef-corsoptionlist" id="ref-for-typedefdef-corsoptionlist-5">CORSOptionList</a>? <a class="nv idl-code" data-link-type="dict-member" data-type="CORSOptionList? " href="#dom-corsoptions-methods" id="ref-for-dom-corsoptions-methods-2">methods</a>;
  <a class="n" data-link-type="idl-name" href="#typedefdef-corsoptionlist" id="ref-for-typedefdef-corsoptionlist-6">CORSOptionList</a>? <a class="nv idl-code" data-link-type="dict-member" data-type="CORSOptionList? " href="#dom-corsoptions-headers" id="ref-for-dom-corsoptions-headers-2">headers</a>;
};
</pre>
   <p class="issue" id="issue-35d576f3"><a class="self-link" href="#issue-35d576f3"></a> WebIDL is almost certainly the wrong way to describe the way the <a data-link-type="dfn" href="#origin-policy" id="ref-for-origin-policy-7"><code>Origin-Policy</code></a> header’s value is constructed. Still, it makes writing
the spec quite a bit simpler, so. We’ll come up with something better
later. Possibly as part of the JSON HTTP Header Field encoding work
ongoing in the HTTP WG.</p>
   <h2 class="heading settled" data-level="3" id="algorithms"><span class="secno">3. </span><span class="content">Algorithms</span><a class="self-link" href="#algorithms"></a></h2>
   <h3 class="heading settled" data-algorithm="Retrieve origin’s manifest version." data-dfn-type="dfn" data-level="3.1" data-lt="Retrieve origin’s manifest version." data-noexport="" id="version-for-origin"><span class="secno">3.1. </span><span class="content"> Retrieve <var>origin</var>’s manifest version. </span><a class="self-link" href="#version-for-origin"></a></h3>
   <p>Given an origin (<var>origin</var>), this algorithm returns <code>0</code> if no manifest is present
in the user agent’s <a data-link-type="dfn" href="#origin-policy-store" id="ref-for-origin-policy-store-3">Origin Policy Store</a>, or a string representing the
cached version otherwise.</p>
   <ol>
    <li data-md="">
     <p>Let <var>version</var> be <code>0</code>.</p>
    <li data-md="">
     <p>If the user agent’s <a data-link-type="dfn" href="#origin-policy-store" id="ref-for-origin-policy-store-4">Origin Policy Store</a> contains a tuple for <var>origin</var>, let <var>version</var> be that tuple’s first element.</p>
    <li data-md="">
     <p>Return <var>version</var>.</p>
   </ol>
   <h3 class="heading settled dfn-paneled" data-algorithm="Evict origin’s cached manifest." data-dfn-type="dfn" data-level="3.2" data-lt="Evict origin’s cached manifest." data-noexport="" id="evict-for-origin"><span class="secno">3.2. </span><span class="content"> Evict <var>origin</var>’s cached manifest. </span></h3>
   <p>Given an origin (<var>origin</var>), this algorithm removes any cached manifest from the
user agent’s <a data-link-type="dfn" href="#origin-policy-store" id="ref-for-origin-policy-store-5">Origin Policy Store</a>:</p>
   <ol>
    <li data-md="">
     <p>Instruct the user agent’s <a data-link-type="dfn" href="#origin-policy-store" id="ref-for-origin-policy-store-6">Origin Policy Store</a> to <a data-link-type="dfn" href="#evict-an-origin-policy-for-an-origin" id="ref-for-evict-an-origin-policy-for-an-origin-1">evict</a> any <a data-link-type="dfn" href="#origin-policy-object" id="ref-for-origin-policy-object-4">Origin Policy object</a> stored for <var>origin</var>.</p>
   </ol>
   <h3 class="heading settled" data-level="3.3" id="monkey-patching-html"><span class="secno">3.3. </span><span class="content">HTML Integration</span><a class="self-link" href="#monkey-patching-html"></a></h3>
   <p>At the end of the navigation algorithm, we’ll do the following:</p>
   <ol>
    <li data-md="">
     <p>If we have a policy for the origin to which we’ve navigated (or we’re inheriting the
  origin for an <code>about:blank</code> or <code>about:srcdoc</code> (or if we’re Firefox, <code>data:...</code>),
  then we apply the policy to the document as defined in <a href="#html-apply-policy" id="ref-for-html-apply-policy-1">§3.3.1 Apply Origin Policy to settings.</a> (which
  I haven’t written yet.</p>
   </ol>
   <p>At the end of the "run a worker" algorithm, we’ll do the same thing.</p>
   <h4 class="heading settled dfn-paneled" data-algorithm="Apply Origin Policy to settings." data-dfn-type="dfn" data-level="3.3.1" data-lt="Apply Origin Policy to settings." data-noexport="" id="html-apply-policy"><span class="secno">3.3.1. </span><span class="content"> Apply Origin Policy to <var>settings</var>. </span></h4>
   <p class="issue" id="issue-7275c976"><a class="self-link" href="#issue-7275c976"></a> Write this algorithm.</p>
   <h3 class="heading settled" data-level="3.4" id="monkey-patching-fetch"><span class="secno">3.4. </span><span class="content">Fetch Integration</span><a class="self-link" href="#monkey-patching-fetch"></a></h3>
   <p>During a navigation request, Fetch will hook into this specification in two ways:</p>
   <ol>
    <li data-md="">
     <p>At the top of the basic fetch algorithm, Fetch will call <a href="#fetch-prepare-request" id="ref-for-fetch-prepare-request-1">§3.4.1 Prepare request with Origin Policy.</a> in order to append <code>Origin-Policy</code> to the
  request’s header list with a value of <code>1</code>.</p>
    <li data-md="">
     <p>When a response is received during HTTP-network fetch algorithm, Fetch will
  call into <a href="#fetch-parse-response" id="ref-for-fetch-parse-response-1">§3.4.2 Process response for Origin Policy.</a> to sift through its headers, and
  extract the <code>Origin-Policy</code> header. If present, and its value does not match
  the value of the locally cached manifest for the response’s origin, we’ll issue
  a synchronous request for a resource located on the request’s URL’s origin at <code>/.well-known/origin-policy/{value}</code>, as defined in <a href="#fetch-parse-response" id="ref-for-fetch-parse-response-2">§3.4.2 Process response for Origin Policy.</a>.</p>
     <p>The manifest request will fail in a draconian fashion: if <a href="#fetch-parse-response" id="ref-for-fetch-parse-response-3">§3.4.2 Process response for Origin Policy.</a> returns "<code>Failure</code>", the response to the request
  which triggered the manifest request will be set to a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-network-error">network error</a>.</p>
     <p class="issue" id="issue-43a867ce"><a class="self-link" href="#issue-43a867ce"></a> Should we allow service workers to intercept/set policy? Maybe only if they
  are scoped to the whole origin?</p>
    <li data-md="">
     <p>Directly after Fetch calls into <a href="#fetch-parse-response" id="ref-for-fetch-parse-response-4">§3.4.2 Process response for Origin Policy.</a>, it will call into <a href="#fetch-apply-policy" id="ref-for-fetch-apply-policy-1">§3.4.3 Apply an Origin Policy to response.</a> to apply any cached policy to the response.</p>
    <li data-md="">
     <p>Before issuing a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#cors-preflight-request">CORS-preflight request</a>, Fetch will call into <a href="#fetch-bypass-preflight" id="ref-for-fetch-bypass-preflight-3">§3.4.4 Does Origin Policy bypass request’s CORS-preflight request?</a> in order to determine whether the preflight is
  necessary. If that algorithm returns "<code>Bypass</code>", Fetch will not issue a
  preflight request, but instead proceed as though the preflight succeeded.
  Otherwise, the preflight will be issued as usual.</p>
   </ol>
   <h4 class="heading settled dfn-paneled" data-algorithm="Prepare request with Origin Policy." data-dfn-type="dfn" data-level="3.4.1" data-lt="Prepare request with Origin Policy." data-noexport="" id="fetch-prepare-request"><span class="secno">3.4.1. </span><span class="content"> Prepare <var>request</var> with Origin Policy. </span></h4>
   <p>Given a request <var>request</var>, add appropriate headers to inform a server about a
client’s active policy:</p>
   <ol>
    <li data-md="">
     <p>If <var>request</var> is not a navigation request, or if <a href="https://w3c.github.io/webappsec-secure-contexts/#is-url-trustworthy">Secure Contexts §is-url-trustworthy</a> returns "<code>Not Trustworthy</code>" when
  executed upon <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url">url</a>, then abort these steps.</p>
    <li data-md="">
     <p>Append a header named <code>Origin-Policy</code> with a value of <code>1</code> to <var>request</var>’s
  header list.</p>
   </ol>
   <h4 class="heading settled dfn-paneled" data-algorithm="Process response for Origin Policy." data-dfn-type="dfn" data-level="3.4.2" data-lt="Process response for Origin Policy." data-noexport="" id="fetch-parse-response"><span class="secno">3.4.2. </span><span class="content"> Process <var>response</var> for Origin Policy. </span></h4>
   <p>Given a response (<var>response</var>), this algorithm will sift through its headers, and
fetch or evict the relevant <a data-link-type="dfn" href="#origin-policy-manifest" id="ref-for-origin-policy-manifest-6">Origin Policy Manifest</a> as follows:</p>
   <ul>
    <li data-md="">
     <p>If no "<code>Origin-Policy</code>" header is present, this algorithm returns "<code>No-op</code>".</p>
    <li data-md="">
     <p>If an "<code>Origin-Policy</code>" header is present with a value of <code>0</code>, this
 algorithm will evict the relevant manifest, and return "<code>Success</code>".</p>
    <li data-md="">
     <p>If an "<code>Origin-Policy</code>" header is present with a non-<code>0</code> value, this
 algorithm will attempt to fetch the specified manifest. If successful,
 the manifest will be cached locally, and this algorithm will return
 "<code>Success</code>". If the fetch fails, this algorithm will return "<code>Failure</code>".</p>
   </ul>
   <ol>
    <li data-md="">
     <p>Let <var>version</var> be the result of parsing "<code>Origin-Policy</code>" in <var>response</var>’s
  header list.</p>
    <li data-md="">
     <p>Let <var>url</var> be a copy of <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-url">URL</a>.</p>
    <li data-md="">
     <p>Return "<code>No-op</code>" if any of the following statements are true:</p>
     <ol>
      <li data-md="">
       <p><var>version</var> is <code>null</code>.</p>
      <li data-md="">
       <p><a href="https://w3c.github.io/webappsec-secure-contexts/#is-url-trustworthy">Secure Contexts §is-url-trustworthy</a> returns "<code>Not Trustworthy</code>" when
  executed upon <var>url</var>.</p>
     </ol>
    <li data-md="">
     <p class="assertion">Assert: <var>url</var> is not an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-opaque-origin">opaque origin</a>.</p>
    <li data-md="">
     <p>Return "<code>Failure</code>" if <var>version</var> does not match the <a data-link-type="grammar" href="#grammardef-manifest-name" id="ref-for-grammardef-manifest-name-2">manifest-name</a> grammar.</p>
    <li data-md="">
     <p>If <var>version</var> is <code>0</code>:</p>
     <ol>
      <li data-md="">
       <p>Execute <a href="#evict-for-origin" id="ref-for-evict-for-origin-1">§3.2 Evict origin’s cached manifest.</a> upon <var>url</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin">origin</a>.</p>
      <li data-md="">
       <p>Return "<code>Success</code>".</p>
     </ol>
    <li data-md="">
     <p>Replace <var>url</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-path">path</a> with the concatenation of
  "<code>/.well-known/origin-policy/</code>" and <var>version</var>.</p>
    <li data-md="">
     <p>Let <var>request</var> be a new request with the following properties:</p>
     <dl>
      <dt data-md="">
       <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url">url</a></p>
      <dd data-md="">
       <p><var>url</var></p>
      <dt data-md="">
       <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client">client</a></p>
      <dd data-md="">
       <p><code>null</code></p>
      <dt data-md="">
       <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#skip-service-worker-flag">skip-service-worker flag</a></p>
      <dd data-md="">
       <p>Set</p>
      <dt data-md="">
       <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-destination">destination</a></p>
      <dd data-md="">
       <p>"<code>manifest</code>"</p>
      <dt data-md="">
       <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-mode">mode</a></p>
      <dd data-md="">
       <p>"<code>same-origin</code>"</p>
      <dt data-md="">
       <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-redirect-mode">redirect mode</a></p>
      <dd data-md="">
       <p>"<code>error</code>"</p>
     </dl>
    <li data-md="">
     <p>Let <var>response</var> be the result of performing an HTTP-network-or-cache fetch
  using <var>request</var>.</p>
    <li data-md="">
     <p>If <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-status">status</a> is an <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#ok-status">ok status</a>:</p>
     <ol>
      <li data-md="">
       <p>Let <var>MIME type</var> be the result of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-extract-mime-type">extracting a MIME type</a> from <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list">header list</a>.</p>
      <li data-md="">
       <p>If <var>MIME type</var> is not <code>application/manifest+json</code>, abort these steps
  and return "<code>Failure</code>".</p>
      <li data-md="">
       <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-body-wait">Wait</a> for <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body">body</a>.</p>
      <li data-md="">
       <p>Store the tuple (<var>version</var>, <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body">body</a>) in
  the user agent’s <a data-link-type="dfn" href="#origin-policy-store" id="ref-for-origin-policy-store-7">Origin Policy Store</a> for <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-url">URL</a>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin">origin</a>.</p>
      <li data-md="">
       <p>Return "<code>Success</code>".</p>
     </ol>
    <li data-md="">
     <p>Return "<code>Failure</code>"</p>
   </ol>
   <h4 class="heading settled dfn-paneled" data-algorithm="Apply an Origin Policy to response." data-dfn-type="dfn" data-level="3.4.3" data-lt="Apply an Origin Policy to response." data-noexport="" id="fetch-apply-policy"><span class="secno">3.4.3. </span><span class="content"> Apply an Origin Policy to <var>response</var>. </span></h4>
   <p>Given a response (<var>response</var>), the following algorithm applies the relevant <a data-link-type="dfn" href="#origin-policy-object" id="ref-for-origin-policy-object-5">origin policy object</a>:</p>
   <ol>
    <li data-md="">
     <p>Let <var>origin</var> be <var>response</var>’s URL’s origin.</p>
    <li data-md="">
     <p>If <var>origin</var> is an opaque origin, or if <a href="https://w3c.github.io/webappsec-secure-contexts/#is-origin-trustworthy">Secure Contexts §is-origin-trustworthy</a> returns "<code>Not Trustworthy</code>" when
  executed upon <var>origin</var>, abort these steps and return.</p>
    <li data-md="">
     <p>Let <var>object</var> be the result of instructing the user agent’s <a data-link-type="dfn" href="#origin-policy-store" id="ref-for-origin-policy-store-8">Origin Policy
  Store</a> to <a data-link-type="dfn" href="#retrieve-an-origin-policy-for-an-origin" id="ref-for-retrieve-an-origin-policy-for-an-origin-1">retrieve an Origin Policy
  object</a> for <var>origin</var>.</p>
    <li data-md="">
     <p>If <var>object</var> is <code>null</code>, abort these steps and return.</p>
    <li data-md="">
     <p>Set <var>policy</var> to <var>object</var>’s <a data-link-type="dfn" href="#origin-policy-object-body" id="ref-for-origin-policy-object-body-1">body</a>.</p>
    <li data-md="">
     <p>For each member (<var>member</var>) in <var>policy</var>, execute the steps associated with
  the matching statement below:</p>
     <dl>
      <dt data-md="">
       <p><a data-link-type="dfn" href="#headers" id="ref-for-headers-6"><code>headers</code></a></p>
      <dd data-md="">
       <ol>
        <li data-md="">
         <p>If <var>member</var>’s value is not valid as defined in <a href="#headers-member">§2.3.2 The headers member</a>,
    abort these steps and return.</p>
         <p class="issue" id="issue-d22f5cea"><a class="self-link" href="#issue-d22f5cea"></a> Is there a better way to define validity? JSON schema?</p>
         <ol start="2">
          <li data-md="">
           <p>Let <var>headers</var> be an empty list.</p>
          <li data-md="">
           <p>For each <var>header</var> in <var>member</var>’s value:</p>
           <ol>
            <li data-md="">
             <p>Let <var>name</var> be <var>header</var>’s <code class="idl"><a data-link-type="idl" href="#dom-httpheader-name" id="ref-for-dom-httpheader-name-13">name</a></code>, and <var>value</var> be <var>header</var>’s <code class="idl"><a data-link-type="idl" href="#dom-httpheader-value" id="ref-for-dom-httpheader-value-13">value</a></code>.</p>
            <li data-md="">
             <p>If <var>header</var>’s <code class="idl"><a data-link-type="idl" href="#dom-httpheader-type" id="ref-for-dom-httpheader-type-13">type</a></code> is "<code>fallback</code>", and the
  result of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-parse">parsing</a> <var>name</var> in <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list">header list</a> is not <code>null</code>,
  skip the remaining substep, and proceed to the next <var>header</var>.</p>
             <p class="note" role="note">Note: We check the header’s presence <em>before</em> applying <a data-link-type="dfn" href="#baseline-headers" id="ref-for-baseline-headers-2">baseline headers</a> to <var>response</var>.</p>
            <li data-md="">
             <p>Append <var>header</var>’s value to <var>headers</var>.</p>
           </ol>
         </ol>
         <p class="note" role="note">Note: Once a policy is cached for an origin, the headers it applies
will never change. User agents are encouraged to implement more
performant algorithms making use of this invariant.</p>
       </ol>
     </dl>
   </ol>
   <h4 class="heading settled dfn-paneled" data-algorithm="Does Origin Policy bypass request’s CORS-preflight request?" data-dfn-type="dfn" data-level="3.4.4" data-lt="Does Origin Policy bypass request’s CORS-preflight request?" data-noexport="" id="fetch-bypass-preflight"><span class="secno">3.4.4. </span><span class="content"> Does Origin Policy bypass <var>request</var>’s CORS-preflight request? </span></h4>
   <p>Given a request (<var>request</var>), this algorithm returns "<code>Bypass</code>" if the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#cors-preflight-request">CORS-preflight request</a> required for <var>request</var> can be fulfilled by
examining the target origin’s <a data-link-type="dfn" href="#origin-policy-manifest" id="ref-for-origin-policy-manifest-7">Origin Policy Manifest</a>, and "<code>Does Not
Bypass</code>" if the preflight is required:</p>
   <ol>
    <li data-md="">
     <p>Let <var>manifest</var> be the result of <a data-link-type="dfn" href="#retrieve-an-origin-policy-for-an-origin" id="ref-for-retrieve-an-origin-policy-for-an-origin-2">retrieving
  an Origin Policy</a> for <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url">url</a>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin">origin</a>.</p>
    <li data-md="">
     <p>If <var>manifest</var> is <code>null</code>, return "<code>Does Not Bypass</code>".</p>
    <li data-md="">
     <p>Set <var>manifest</var> to <var>manifest</var>’s <a data-link-type="dfn" href="#origin-policy-object-body" id="ref-for-origin-policy-object-body-2">body</a>.</p>
    <li data-md="">
     <p>Let <var>options</var> be <var>manifest</var>’s <a data-link-type="dfn" href="#cors-preflight" id="ref-for-cors-preflight-4"><code>cors-preflight</code></a> member’s value if <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-credentials-mode">credentials mode</a> is "<code>omit</code>", and <var>manifest</var>’s <a data-link-type="dfn" href="#unsafe-cors-preflight-with-credentials" id="ref-for-unsafe-cors-preflight-with-credentials-6"><code>unsafe-cors-preflight-with-credentials</code></a> member’s value
  otherwise.</p>
    <li data-md="">
     <p>Return "<code>Does Not Bypass</code>" if any of the following are true:</p>
     <ol>
      <li data-md="">
       <p><var>options</var> is not a <code class="idl"><a data-link-type="idl" href="#dictdef-corsoptions" id="ref-for-dictdef-corsoptions-2">CORSOptions</a></code> object.</p>
      <li data-md="">
       <p><var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-credentials-mode">credentials mode</a> is "<code>include</code>", and
  any of <var>options</var>’s <code class="idl"><a data-link-type="idl" href="#dom-corsoptions-origins" id="ref-for-dom-corsoptions-origins-7">origins</a></code>, <code class="idl"><a data-link-type="idl" href="#dom-corsoptions-methods" id="ref-for-dom-corsoptions-methods-3">methods</a></code>,
  or <code class="idl"><a data-link-type="idl" href="#dom-corsoptions-headers" id="ref-for-dom-corsoptions-headers-3">headers</a></code> member’s values are "<code class="idl"><a data-link-type="idl" href="#dom-wildcard" id="ref-for-dom-wildcard-7">*</a></code>".</p>
      <li data-md="">
       <p><var>options</var>’s <code class="idl"><a data-link-type="idl" href="#dom-corsoptions-origins" id="ref-for-dom-corsoptions-origins-8">origins</a></code> is not "<code class="idl"><a data-link-type="idl" href="#dom-wildcard" id="ref-for-dom-wildcard-8">*</a></code>", and the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#unicode-serialisation-of-an-origin">serialization</a> of <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-origin">origin</a> is not an <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#case-sensitive">case-sensitive</a> match for any of the items in <var>options</var>’s <code class="idl"><a data-link-type="idl" href="#dom-corsoptions-origins" id="ref-for-dom-corsoptions-origins-9">origins</a></code> sequence.</p>
      <li data-md="">
       <p><var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-method">method</a> (<var>method</var>) is not a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#cors-safelisted-method">CORS-safelisted method</a>, and <var>options</var>’s <code class="idl"><a data-link-type="idl" href="#dom-corsoptions-methods" id="ref-for-dom-corsoptions-methods-4">methods</a></code> is not "<code class="idl"><a data-link-type="idl" href="#dom-wildcard" id="ref-for-dom-wildcard-9">*</a></code>", and <var>method</var> is not a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#case-sensitive">case-sensitive</a> match for
  any of the items in <var>options</var>’s <code class="idl"><a data-link-type="idl" href="#dom-corsoptions-methods" id="ref-for-dom-corsoptions-methods-5">methods</a></code> sequence.</p>
      <li data-md="">
       <p><var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list">header list</a> (<var>list</var>) contains headers
  which are not <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#cors-safelisted-request-header">CORS-safelisted request-headers</a>, and <var>options</var>’s <code class="idl"><a data-link-type="idl" href="#dom-corsoptions-headers" id="ref-for-dom-corsoptions-headers-4">headers</a></code> is not "<code class="idl"><a data-link-type="idl" href="#dom-wildcard" id="ref-for-dom-wildcard-10">*</a></code>", and one or more of <var>list</var>’s
  non-<a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#cors-safelisted-request-header">CORS-safelisted request-headers</a>' <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-name">names</a> is not an <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#ascii-case-insensitive">ASCII case-insensitive</a> match for any of the items in <var>options</var>’s <code class="idl"><a data-link-type="idl" href="#dom-corsoptions-headers" id="ref-for-dom-corsoptions-headers-5">headers</a></code> sequence.</p>
     </ol>
    <li data-md="">
     <p>Return "<code>Bypass</code>".</p>
   </ol>
   <h2 class="heading settled" data-level="4" id="specification"><span class="secno">4. </span><span class="content">Specification Considerations</span><a class="self-link" href="#specification"></a></h2>
   <h3 class="heading settled" data-level="4.1" id="app-manifest"><span class="secno">4.1. </span><span class="content">Relation to Web App Manifests</span><a class="self-link" href="#app-manifest"></a></h3>
   <p>It might make sense to combine this mechanism with the manifest notion
defined in <a data-link-type="biblio" href="#biblio-appmanifest">[APPMANIFEST]</a>. There are a few distinctions, however, which
lead to the current design:</p>
   <ol>
    <li data-md="">
     <p>The =Security Policy Manifest= is delivered synchronously during navigation,
  which gives it a number of valuable security properties. The web app
  manifest, on the other hand, is delivered inline via a <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/semantics.html#the-link-element">link</a></code> element,
  which makes it less valuable from that perspective.</p>
    <li data-md="">
     <p>Web app manifests can live anywhere on an origin, and anywhere on any other
  origin, for that matter. This might make sense for the feature set it wishes
  to expose, but it would expose an origin to unnecessary risk to be quite so
  loose with =security policy manifest= files.</p>
   </ol>
   <p>Nevertheless, we should consider ways to merge this policy with <a data-link-type="biblio" href="#biblio-appmanifest">[APPMANIFEST]</a>.
Perhaps we could accept a certain set of attributes was parsed iff certain
properties of the request are true (same-origin, specific path, etc). Something
to look into. For now, we’ve done the simple thing as a strawman.</p>
   <h3 class="heading settled" data-level="4.2" id="why-well-known"><span class="secno">4.2. </span><span class="content">Why <code>.well-known</code>?</span><a class="self-link" href="#why-well-known"></a></h3>
   <p>This document forces the manifest to live as a resource accessible under a
"well-known location" specific to Origin Policy manifests. It would increase
flexibility of deployment and implementation if we allowed a developer to point
to any location on an origin instead. Perhaps something like the following:</p>
<pre>  Origin-Policy: /path/to/manifest.json
</pre>
   <p>This would allow developers who control an application, but not the server on
which the application runs, to define policy for themselves without bothering
the sysadmins and filing internal tickets to get a <code>.well-known</code> directory
created, populated, and mapped to something externally accessible.</p>
   <p>So why does this document force a well-known location?</p>
   <p>In short, this document posits that setting a policy for an origin is an action
that should, in fact, involve the folks responsible for running the origin’s
server, as it has cross-cutting effects upon <em>every</em> application hosted
on an origin. Unlike a response-specific <code>Content-Security-Policy</code> header, the <a data-link-type="dfn" href="#headers" id="ref-for-headers-7"><code>headers</code></a> member can apply a baseline policy to <em>all</em> the responses
an origin emits. This can be hugely benificial, but also hugely destructive.</p>
   <p>Consider, for example, MegaCorp, Inc.'s <code>https://example.com</code>, which
hosts a mail application, a mapping application, a document editing application,
and so on. It would be unfortunate indeed if one of these applications
accidentally pinned a policy to the entire origin which didn’t account for the
rest of the origin’s contents. To mitigate that risk, this document forces the
manifest to live in a shared location for an origin. The goal is explicitly to
eilicit the kind of discussion and compromise within an origin that needs to
happen in order to deploy an Origin Policy safely.</p>
   <h2 class="heading settled" data-level="5" id="authoring"><span class="secno">5. </span><span class="content">Authoring Considerations</span><a class="self-link" href="#authoring"></a></h2>
   <h3 class="heading settled" data-level="5.1" id="headers-to-set"><span class="secno">5.1. </span><span class="content">Headers To Set</span><a class="self-link" href="#headers-to-set"></a></h3>
   <p>Authors SHOULD explicitly set a number of headers to construct a reasonable
policy for their sites. Among the most important are:</p>
   <ul>
    <li data-md="">
     <p><code>Content-Security-Policy</code> <a data-link-type="biblio" href="#biblio-csp3">[CSP3]</a></p>
    <li data-md="">
     <p><code>Strict-Transport-Security</code> <a data-link-type="biblio" href="#biblio-rfc6797">[RFC6797]</a></p>
    <li data-md="">
     <p><code>X-Content-Type-Options</code> <a data-link-type="biblio" href="#biblio-fetch">[FETCH]</a></p>
   </ul>
   <p class="issue" id="issue-7b28cc0b"><a class="self-link" href="#issue-7b28cc0b"></a> Give some reasonable recommendations here, with links to tutorials if possible.</p>
   <h3 class="heading settled" data-level="5.2" id="perf"><span class="secno">5.2. </span><span class="content">Performance</span><a class="self-link" href="#perf"></a></h3>
   <p>Servers SHOULD set a long cache lifetime for the manifest file, using the version
to change policy for an origin as opposed to changing the existing policy and
relying on cache expiration.</p>
   <h3 class="heading settled" data-level="5.3" id="server-push"><span class="secno">5.3. </span><span class="content">Server Push</span><a class="self-link" href="#server-push"></a></h3>
   <p>To speed up the initial, synchronous request for the manifest file, servers
SHOULD use the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7540#section-8.2">Server Push</a> mechanism defined in <a data-link-type="biblio" href="#biblio-rfc7540">[RFC7540]</a> to get the
manifest down to the client as quickly as possible.</p>
   <ol>
    <li data-md="">
     <p>Send a <code>PUSH_PROMISE</code> frame with a minimal request for the manifest,
  aligning with the request generated in <a href="#fetch-parse-response" id="ref-for-fetch-parse-response-5">§3.4.2 Process response for Origin Policy.</a>.</p>
    <li data-md="">
     <p>Begin delivering the response to the <code>PUSH_PROMISE</code> request.</p>
   </ol>
   <p class="issue" id="issue-7cbc18d1"><a class="self-link" href="#issue-7cbc18d1"></a> Spell this out with an example.</p>
   <h3 class="heading settled" data-level="5.4" id="strict-dynamic"><span class="secno">5.4. </span><span class="content">CSP: Nonces and <code>'strict-dynamic'</code></span><a class="self-link" href="#strict-dynamic"></a></h3>
   <p>Content Security Policy has introduced some dynamic mechanisms that are quite
valuable in terms of encouraging deployment. Nonces, along with the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-strict-dynamic"><code>'strict-dynamic'</code></a> expression are a good example of an
implementation which requires a server to send a fresh value down with each
response. Origin Policy can support such deployments via the "<code>fallback</code>"
mechanism as follows:</p>
   <div class="example" id="example-3d5941d3">
    <a class="self-link" href="#example-3d5941d3"></a> MegaCorp, Inc. wishes to deploy a strong Content Security Policy which blocks
plugins and framing altogether, but which uses <code>'strict-dynamic'</code> along with a
fresh nonce for each resource in order to reduce the risk of cross-site
scripting. It can do so by combining a "<code>baseline</code>" and "<code>fallback</code>" policy in
the <a data-link-type="dfn" href="#origin-policy-manifest" id="ref-for-origin-policy-manifest-8">Origin Policy Manifest</a>, and delivering a <code>Content-Security-Policy</code> header along with each response. 
    <p>That is, the manifest file might contain the following JSON:</p>
<pre>{
  ...
  "<a data-link-type="dfn" href="#headers" id="ref-for-headers-8">headers</a>": [
    {
      "<a data-link-type="idl" href="#dom-httpheader-name" id="ref-for-dom-httpheader-name-14">name</a>": "Content-Security-Policy",
      "<a data-link-type="idl" href="#dom-httpheader-value" id="ref-for-dom-httpheader-value-14">value</a>": "script-src 'none'",
      "<a data-link-type="idl" href="#dom-httpheader-type" id="ref-for-dom-httpheader-type-14">type</a>": "fallback"
    },
    {
      "<a data-link-type="idl" href="#dom-httpheader-name" id="ref-for-dom-httpheader-name-15">name</a>": "Content-Security-Policy",
      "<a data-link-type="idl" href="#dom-httpheader-value" id="ref-for-dom-httpheader-value-15">value</a>": "object-src 'none'; frame-ancestors 'self'",
      "<a data-link-type="idl" href="#dom-httpheader-type" id="ref-for-dom-httpheader-type-15">type</a>": "baseline"
    }
  },
  ...
}
</pre>
    <p>And each resource’s response might contain the following header:</p>
<pre><a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#header-content-security-policy">Content-Security-Policy</a>: script-src 'nonce-{nonce-goes-here}' 'strict-dynamic'
</pre>
    <p>The baseline policy will be applied to every response, blocking plugins and
restricting framing regardless of the response’s other headers.</p>
    <p>The fallback policy will be applied iff the response doesn’t itself provide a
Content Security Policy, meaning that the resource’s policy will be applied,
the nonce will be active, and script will execute as expected.</p>
   </div>
   <h2 class="heading settled" data-level="6" id="privacy-and-security"><span class="secno">6. </span><span class="content">Privacy and Security Considerations</span><a class="self-link" href="#privacy-and-security"></a></h2>
   <p class="issue" id="issue-3b945ec3"><a class="self-link" href="#issue-3b945ec3"></a> Add some considerations here.</p>
   <h2 class="heading settled" data-level="7" id="iana"><span class="secno">7. </span><span class="content">IANA Considerations</span><a class="self-link" href="#iana"></a></h2>
   <h3 class="heading settled" data-level="7.1" id="iana-header"><span class="secno">7.1. </span><span class="content">The <code>Origin-Policy</code> header</span><a class="self-link" href="#iana-header"></a></h3>
   <p>The permanent message header field registry should be updated
with the following registration: <a data-link-type="biblio" href="#biblio-rfc3864">[RFC3864]</a></p>
   <dl>
    <dt data-md="">
     <p>Header field name</p>
    <dd data-md="">
     <p><code>Origin-Policy</code></p>
    <dt data-md="">
     <p>Applicable protocol</p>
    <dd data-md="">
     <p>http</p>
    <dt data-md="">
     <p>Status</p>
    <dd data-md="">
     <p>WIP</p>
    <dt data-md="">
     <p>Author/Change controller</p>
    <dd data-md="">
     <p>W3C</p>
    <dt data-md="">
     <p>Specification document</p>
    <dd data-md="">
     <p>This specification (see <a href="#origin-policy-header">§2.2 The Origin-Policy HTTP Header Field</a>)</p>
   </dl>
   <h3 class="heading settled" data-level="7.2" id="iana-well-known"><span class="secno">7.2. </span><span class="content">Creation of the well-known location <code>origin-policy</code></span><a class="self-link" href="#iana-well-known"></a></h3>
   <p>This document defines a well-known location at which <a data-link-type="dfn" href="#origin-policy-manifest" id="ref-for-origin-policy-manifest-9">Origin Policy
manifests</a> may be found. In accordance with <a data-link-type="biblio" href="#biblio-rfc5758">[RFC5758]</a>, the following
registration should be made if and when the proposal in this document gains
acceptance and implementation:</p>
   <dl>
    <dt data-md="">
     <p>URI Suffix</p>
    <dd data-md="">
     <p><code>origin-policy</code></p>
    <dt data-md="">
     <p>Change Controller</p>
    <dd data-md="">
     <p>W3C</p>
    <dt data-md="">
     <p>Specification document</p>
    <dd data-md="">
     <p>This document (see <a href="#origin-policy-well-known">§2.3.1 The origin-policy well-known location</a>)</p>
    <dt data-md="">
     <p>Related information</p>
    <dd data-md="">
     <p>The suffix <code>origin-policy</code> is expected to be followed by an additional path
  component which names a specific <a data-link-type="dfn" href="#origin-policy-manifest" id="ref-for-origin-policy-manifest-10">Origin Policy manifest</a> (e.g. <code>/.well-known/origin-policy/name</code>). A request to <code>/.well-known/origin-policy</code> can be expected to redirect to the most current
  policy for an origin.</p>
   </dl>
   <h2 class="heading settled" data-level="8" id="ack"><span class="secno">8. </span><span class="content">Acknowledgements</span><a class="self-link" href="#ack"></a></h2>
   <p>Mark Nottingham came up with more or less the same idea at more or less the
same time (after waiting ~years for me to write this up) <a data-link-type="biblio" href="#biblio-site-wide-headers">[SITE-WIDE-HEADERS]</a>.
I’ve swiped large swaths of his introduction, and turned a mess of a syntax into <a data-link-type="dfn" href="#headers" id="ref-for-headers-9"><code>headers</code></a>, as it’s better than what I was coming up with. Likewise,
Takeshi Yoshino’s <a data-link-type="biblio" href="#biblio-origin-wide-cors">[ORIGIN-WIDE-CORS]</a> proposal covers similar ground.</p>
   <p>Mike O’Neill and Brad Hill helped mitigate the privacy implications of an
earlier design for the feature-advertising request header. Anne van Kesteren
helped ensure that the CORS-request preflight bits were sane.</p>
  </main>
<script>
(function() {
  "use strict";
  var collapseSidebarText = '<span aria-hidden="true">←</span> '
                          + '<span>Collapse Sidebar</span>';
  var expandSidebarText   = '<span aria-hidden="true">→</span> '
                          + '<span>Pop Out Sidebar</span>';
  var tocJumpText         = '<span aria-hidden="true">↑</span> '
                          + '<span>Jump to Table of Contents</span>';

  var sidebarMedia = window.matchMedia('screen and (min-width: 78em)');
  var autoToggle   = function(e){ toggleSidebar(e.matches) };
  if(sidebarMedia.addListener) {
    sidebarMedia.addListener(autoToggle);
  }

  function toggleSidebar(on) {
    if (on == undefined) {
      on = !document.body.classList.contains('toc-sidebar');
    }

    /* Don’t scroll to compensate for the ToC if we’re above it already. */
    var headY = 0;
    var head = document.querySelector('.head');
    if (head) {
      // terrible approx of "top of ToC"
      headY += head.offsetTop + head.offsetHeight;
    }
    var skipScroll = window.scrollY < headY;

    var toggle = document.getElementById('toc-toggle');
    var tocNav = document.getElementById('toc');
    if (on) {
      var tocHeight = tocNav.offsetHeight;
      document.body.classList.add('toc-sidebar');
      document.body.classList.remove('toc-inline');
      toggle.innerHTML = collapseSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, 0 - tocHeight);
      }
      tocNav.focus();
      sidebarMedia.addListener(autoToggle); // auto-collapse when out of room
    }
    else {
      document.body.classList.add('toc-inline');
      document.body.classList.remove('toc-sidebar');
      toggle.innerHTML = expandSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, tocNav.offsetHeight);
      }
      if (toggle.matches(':hover')) {
        /* Unfocus button when not using keyboard navigation,
           because I don’t know where else to send the focus. */
        toggle.blur();
      }
    }
  }

  function createSidebarToggle() {
    /* Create the sidebar toggle in JS; it shouldn’t exist when JS is off. */
    var toggle = document.createElement('a');
      /* This should probably be a button, but appearance isn’t standards-track.*/
    toggle.id = 'toc-toggle';
    toggle.class = 'toc-toggle';
    toggle.href = '#toc';
    toggle.innerHTML = collapseSidebarText;

    sidebarMedia.addListener(autoToggle);
    var toggler = function(e) {
      e.preventDefault();
      sidebarMedia.removeListener(autoToggle); // persist explicit off states
      toggleSidebar();
      return false;
    }
    toggle.addEventListener('click', toggler, false);


    /* Get <nav id=toc-nav>, or make it if we don’t have one. */
    var tocNav = document.getElementById('toc-nav');
    if (!tocNav) {
      tocNav = document.createElement('p');
      tocNav.id = 'toc-nav';
      /* Prepend for better keyboard navigation */
      document.body.insertBefore(tocNav, document.body.firstChild);
    }
    /* While we’re at it, make sure we have a Jump to Toc link. */
    var tocJump = document.getElementById('toc-jump');
    if (!tocJump) {
      tocJump = document.createElement('a');
      tocJump.id = 'toc-jump';
      tocJump.href = '#toc';
      tocJump.innerHTML = tocJumpText;
      tocNav.appendChild(tocJump);
    }

    tocNav.appendChild(toggle);
  }

  var toc = document.getElementById('toc');
  if (toc) {
    createSidebarToggle();
    toggleSidebar(sidebarMedia.matches);

    /* If the sidebar has been manually opened and is currently overlaying the text
       (window too small for the MQ to add the margin to body),
       then auto-close the sidebar once you click on something in there. */
    toc.addEventListener('click', function(e) {
      if(e.target.tagName.toLowerCase() == "a" && document.body.classList.contains('toc-sidebar') && !sidebarMedia.matches) {
        toggleSidebar(false);
      }
    }, false);
  }
  else {
    console.warn("Can’t find Table of Contents. Please use <nav id='toc'> around the ToC.");
  }

  /* Wrap tables in case they overflow */
  var tables = document.querySelectorAll(':not(.overlarge) > table.data, :not(.overlarge) > table.index');
  var numTables = tables.length;
  for (var i = 0; i < numTables; i++) {
    var table = tables[i];
    var wrapper = document.createElement('div');
    wrapper.className = 'overlarge';
    table.parentNode.insertBefore(wrapper, table);
    wrapper.appendChild(table);
  }

})();
</script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#dom-wildcard">*</a><span>, in §2.3.3</span>
   <li><a href="#fetch-apply-policy">Apply an Origin Policy to response.</a><span>, in §3.4.2</span>
   <li><a href="#html-apply-policy">Apply Origin Policy to settings.</a><span>, in §3.3</span>
   <li><a href="#dom-httpheadertype-baseline">baseline</a><span>, in §2.3.2</span>
   <li><a href="#baseline-headers">baseline headers</a><span>, in §2.3.2</span>
   <li><a href="#origin-policy-object-body">body</a><span>, in §2.1</span>
   <li><a href="#typedefdef-corsoptionlist">CORSOptionList</a><span>, in §2.3.4</span>
   <li><a href="#dictdef-corsoptions">CORSOptions</a><span>, in §2.3.4</span>
   <li><a href="#cors-preflight">cors-preflight</a><span>, in §2.3.3</span>
   <li><a href="#fetch-bypass-preflight">Does Origin Policy bypass request’s CORS-preflight request?</a><span>, in §3.4.3</span>
   <li><a href="#evict-an-origin-policy-for-an-origin">evict an Origin policy for an origin</a><span>, in §2.1</span>
   <li><a href="#evict-for-origin">Evict origin’s cached manifest.</a><span>, in §3.1</span>
   <li><a href="#evict-an-origin-policy-for-an-origin">evict-policy-from-store</a><span>, in §2.1</span>
   <li><a href="#dom-httpheadertype-fallback">fallback</a><span>, in §2.3.2</span>
   <li><a href="#fallback-headers">fallback headers</a><span>, in §2.3.2</span>
   <li><a href="#retrieve-an-origin-policy-for-an-origin">get-policy-from-store</a><span>, in §2.1</span>
   <li>
    headers
    <ul>
     <li><a href="#headers">definition of</a><span>, in §2.3.2</span>
     <li><a href="#dom-corsoptions-headers">dict-member for CORSOptions</a><span>, in §2.3.3</span>
    </ul>
   <li><a href="#dictdef-httpheader">HTTPHeader</a><span>, in §2.3.4</span>
   <li><a href="#enumdef-httpheadertype">HTTPHeaderType</a><span>, in §2.3.4</span>
   <li><a href="#origin-policy-manifest">manifest</a><span>, in §2.3</span>
   <li><a href="#grammardef-manifest-name">manifest-name</a><span>, in §2.2</span>
   <li><a href="#dom-corsoptions-methods">methods</a><span>, in §2.3.3</span>
   <li><a href="#dom-httpheader-name">name</a><span>, in §2.3.2</span>
   <li><a href="#origin-policy">Origin-Policy</a><span>, in §2.2</span>
   <li><a href="#origin-policy-manifest">Origin Policy Manifest</a><span>, in §2.3</span>
   <li><a href="#origin-policy-object">origin policy object</a><span>, in §2.1</span>
   <li><a href="#origin-policy-store">Origin Policy Store</a><span>, in §2.1</span>
   <li><a href="#dom-corsoptions-origins">origins</a><span>, in §2.3.3</span>
   <li><a href="#fetch-prepare-request">Prepare request with Origin Policy.</a><span>, in §3.4</span>
   <li><a href="#fetch-parse-response">Process response for Origin Policy.</a><span>, in §3.4.1</span>
   <li><a href="#retrieve-an-origin-policy-for-an-origin">retrieve an Origin Policy for an origin</a><span>, in §2.1</span>
   <li><a href="#version-for-origin">Retrieve origin’s manifest version.</a><span>, in §3</span>
   <li><a href="#dom-httpheader-type">type</a><span>, in §2.3.2</span>
   <li><a href="#unsafe-cors-preflight-with-credentials">unsafe-cors-preflight-with-credentials</a><span>, in §2.3.3</span>
   <li><a href="#dom-httpheader-value">value</a><span>, in §2.3.2</span>
   <li><a href="#origin-policy-object-version">version</a><span>, in §2.1</span>
   <li><a href="#enumdef-wildcard">Wildcard</a><span>, in §2.3.4</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[CSP3]</a> defines the following terms:
    <ul>
     <li><a href="https://w3c.github.io/webappsec-csp/#grammardef-base64-value">base64-value</a>
    </ul>
   <li>
    <a data-link-type="biblio">[FETCH]</a> defines the following terms:
    <ul>
     <li><a href="https://fetch.spec.whatwg.org/#basic-safe-cors-protocol-setup">basic safe cors protocol setup</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-response-body">body</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-client">client</a>
     <li><a href="https://fetch.spec.whatwg.org/#cors-preflight-request">cors-preflight request</a>
     <li><a href="https://fetch.spec.whatwg.org/#cors-safelisted-method">cors-safelisted method</a>
     <li><a href="https://fetch.spec.whatwg.org/#cors-safelisted-request-header">cors-safelisted request-header</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-credentials-mode">credentials mode</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-destination">destination</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-header-extract-mime-type">extract a mime type</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-response-header-list">header list</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-method">method</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-mode">mode</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-header-name">name</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-network-error">network error</a>
     <li><a href="https://fetch.spec.whatwg.org/#ok-status">ok status</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-origin">origin</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-header-parse">parsing</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-redirect-mode">redirect mode</a>
     <li><a href="https://fetch.spec.whatwg.org/#skip-service-worker-flag">skip-service-worker flag</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-response-status">status</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-url">url</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-body-wait">wait</a>
     <li><a href="https://fetch.spec.whatwg.org/#x-content-type-options-header">x-content-type-options</a>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#concept-opaque-origin">opaque origin</a>
    </ul>
   <li>
    <a data-link-type="biblio">[referrer-policy]</a> defines the following terms:
    <ul>
     <li><a href="https://w3c.github.io/webappsec-referrer-policy/#referrer-policy-header">referrer-policy</a>
    </ul>
   <li>
    <a data-link-type="biblio">[rfc5234]</a> defines the following terms:
    <ul>
     <li><a href="https://tools.ietf.org/html/rfc5234#appendix-B.1">dquote</a>
    </ul>
   <li>
    <a data-link-type="biblio">[RFC6797]</a> defines the following terms:
    <ul>
     <li><a href="https://tools.ietf.org/html/rfc6797#section-8.1">strict-transport-security</a>
    </ul>
   <li>
    <a data-link-type="biblio">[RFC7540]</a> defines the following terms:
    <ul>
     <li><a href="https://tools.ietf.org/html/rfc7540#section-8.2">server push</a>
    </ul>
   <li>
    <a data-link-type="biblio">[WHATWG-URL]</a> defines the following terms:
    <ul>
     <li><a href="https://url.spec.whatwg.org/#concept-url-origin">origin</a>
     <li><a href="https://url.spec.whatwg.org/#concept-url-path">path</a>
    </ul>
   <li>
    <a data-link-type="biblio">[CSP1]</a> defines the following terms:
    <ul>
     <li><a href="https://w3c.github.io/webappsec-csp/#grammardef-strict-dynamic">'strict-dynamic'</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#header-content-security-policy">content-security-policy</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#frame-ancestors">frame-ancestors</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#object-src">object-src</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#script-src">script-src</a>
    </ul>
   <li>
    <a data-link-type="biblio">[WHATWG-DOM]</a> defines the following terms:
    <ul>
     <li><a href="https://dom.spec.whatwg.org/#ascii-case-insensitive">ascii case-insensitive</a>
     <li><a href="https://dom.spec.whatwg.org/#case-sensitive">case-sensitive</a>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><a href="https://html.spec.whatwg.org/multipage/semantics.html#the-link-element">link</a>
     <li><a href="https://html.spec.whatwg.org/multipage/semantics.html#meta">meta</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#unicode-serialisation-of-an-origin">unicode serialisation of an origin</a>
    </ul>
   <li>
    <a data-link-type="biblio">[WebIDL-1]</a> defines the following terms:
    <ul>
     <li><a href="https://heycam.github.io/webidl/#dom-USVString">USVString</a>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-csp1">[CSP1]
   <dd>Brandon Sterne; Adam Barth. <a href="http://dvcs.w3.org/hg/content-security-policy/raw-file/tip/csp-1.0-specification.html">Content Security Policy 1.0</a>. 19 February 2015. NOTE. URL: <a href="http://dvcs.w3.org/hg/content-security-policy/raw-file/tip/csp-1.0-specification.html">http://dvcs.w3.org/hg/content-security-policy/raw-file/tip/csp-1.0-specification.html</a>
   <dt id="biblio-csp3">[CSP3]
   <dd>Mike West. <a href="https://w3c.github.io/webappsec-csp/">Content Security Policy Level 3</a>. 21 June 2016. WD. URL: <a href="https://w3c.github.io/webappsec-csp/">https://w3c.github.io/webappsec-csp/</a>
   <dt id="biblio-fetch">[FETCH]
   <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/">Fetch Standard</a>. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Ian Hickson. <a href="https://html.spec.whatwg.org/multipage/">HTML Standard</a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-rfc3864">[RFC3864]
   <dd>G. Klyne; M. Nottingham; J. Mogul. <a href="https://tools.ietf.org/html/rfc3864">Registration Procedures for Message Header Fields</a>. September 2004. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc3864">https://tools.ietf.org/html/rfc3864</a>
   <dt id="biblio-rfc5234">[RFC5234]
   <dd>D. Crocker, Ed.; P. Overell. <a href="https://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>. January 2008. Internet Standard. URL: <a href="https://tools.ietf.org/html/rfc5234">https://tools.ietf.org/html/rfc5234</a>
   <dt id="biblio-rfc7540">[RFC7540]
   <dd>M. Belshe; R. Peon; M. Thomson, Ed.. <a href="https://tools.ietf.org/html/rfc7540">Hypertext Transfer Protocol Version 2 (HTTP/2)</a>. May 2015. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc7540">https://tools.ietf.org/html/rfc7540</a>
   <dt id="biblio-webidl-1">[WebIDL-1]
   <dd>Cameron McCormack; Boris Zbarsky. <a href="https://heycam.github.io/webidl/">WebIDL Level 1</a>. 8 March 2016. CR. URL: <a href="https://heycam.github.io/webidl/">https://heycam.github.io/webidl/</a>
   <dt id="biblio-whatwg-dom">[WHATWG-DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/">DOM Standard</a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-whatwg-url">[WHATWG-URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/">URL Standard</a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-appmanifest">[APPMANIFEST]
   <dd>Marcos Caceres; et al. <a href="https://w3c.github.io/manifest/">Web App Manifest</a>. 14 July 2016. WD. URL: <a href="https://w3c.github.io/manifest/">https://w3c.github.io/manifest/</a>
   <dt id="biblio-origin-wide-cors">[ORIGIN-WIDE-CORS]
   <dd>Takeshi Yoshino. <a href="https://github.com/tyoshino/origin-wide-cors/blob/master/README.md">Origin-Wide CORS</a>. URL: <a href="https://github.com/tyoshino/origin-wide-cors/blob/master/README.md">https://github.com/tyoshino/origin-wide-cors/blob/master/README.md</a>
   <dt id="biblio-referrer-policy">[REFERRER-POLICY]
   <dd>Jochen Eisinger; Mike West. <a href="https://w3c.github.io/webappsec/specs/referrer-policy/">Referrer Policy</a>. 1 June 2016. WD. URL: <a href="https://w3c.github.io/webappsec/specs/referrer-policy/">https://w3c.github.io/webappsec/specs/referrer-policy/</a>
   <dt id="biblio-rfc5758">[RFC5758]
   <dd>Q. Dang; et al. <a href="https://tools.ietf.org/html/rfc5758">Internet X.509 Public Key Infrastructure: Additional Algorithms and Identifiers for DSA and ECDSA</a>. January 2010. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc5758">https://tools.ietf.org/html/rfc5758</a>
   <dt id="biblio-rfc5785">[RFC5785]
   <dd>M. Nottingham; E. Hammer-Lahav. <a href="https://tools.ietf.org/html/rfc5785">Defining Well-Known Uniform Resource Identifiers (URIs)</a>. April 2010. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc5785">https://tools.ietf.org/html/rfc5785</a>
   <dt id="biblio-rfc6797">[RFC6797]
   <dd>J. Hodges; C. Jackson; A. Barth. <a href="https://tools.ietf.org/html/rfc6797">HTTP Strict Transport Security (HSTS)</a>. November 2012. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc6797">https://tools.ietf.org/html/rfc6797</a>
   <dt id="biblio-rfc7469">[RFC7469]
   <dd>C. Evans; C. Palmer; R. Sleevi. <a href="https://tools.ietf.org/html/rfc7469">Public Key Pinning Extension for HTTP</a>. April 2015. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc7469">https://tools.ietf.org/html/rfc7469</a>
   <dt id="biblio-rfc7541">[RFC7541]
   <dd>R. Peon; H. Ruellan. <a href="https://tools.ietf.org/html/rfc7541">HPACK: Header Compression for HTTP/2</a>. May 2015. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc7541">https://tools.ietf.org/html/rfc7541</a>
   <dt id="biblio-site-wide-headers">[SITE-WIDE-HEADERS]
   <dd>Mark Nottingham. <a href="https://mnot.github.io/I-D/site-wide-headers/">Site-Wide HTTP Headers</a>. URL: <a href="https://mnot.github.io/I-D/site-wide-headers/">https://mnot.github.io/I-D/site-wide-headers/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl def">//
// header member:
//
<span class="kt">enum</span> <a class="nv" href="#enumdef-httpheadertype">HTTPHeaderType</a> { <a class="s idl-code" data-link-type="enum-value" href="#dom-httpheadertype-baseline">"baseline"</a>, <a class="s idl-code" data-link-type="enum-value" href="#dom-httpheadertype-fallback">"fallback"</a> };

<span class="kt">dictionary</span> <a class="nv" href="#dictdef-httpheader">HTTPHeader</a> {
  <span class="kt">required</span> <span class="kt">USVString</span> <a class="nv idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-httpheader-name">name</a>;
  <span class="kt">required</span> <span class="kt">USVString</span> <a class="nv idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-httpheader-value">value</a>;
  <a class="n" data-link-type="idl-name" href="#enumdef-httpheadertype">HTTPHeaderType</a> <a class="nv idl-code" data-default="&quot;baseline&quot;" data-link-type="dict-member" data-type="HTTPHeaderType " href="#dom-httpheader-type">type</a> = "baseline";
};


//
// cors-preflight and unsafe-cors-preflight-with-credentials
//
<span class="kt">enum</span> <a class="nv" href="#enumdef-wildcard">Wildcard</a> { <a class="s idl-code" data-link-type="enum-value" href="#dom-wildcard">"*"</a> };
<span class="kt">typedef</span> (<a class="n" data-link-type="idl-name" href="#enumdef-wildcard">Wildcard</a> <span class="kt">or</span> <span class="kt">sequence</span>&lt;<span class="kt">USVString</span>>) <a class="nv" href="#typedefdef-corsoptionlist">CORSOptionList</a>;

<span class="kt">dictionary</span> <a class="nv" href="#dictdef-corsoptions">CORSOptions</a> {
  <a class="n" data-link-type="idl-name" href="#typedefdef-corsoptionlist">CORSOptionList</a> <a class="nv idl-code" data-link-type="dict-member" data-type="CORSOptionList " href="#dom-corsoptions-origins">origins</a>;
  <a class="n" data-link-type="idl-name" href="#typedefdef-corsoptionlist">CORSOptionList</a>? <a class="nv idl-code" data-link-type="dict-member" data-type="CORSOptionList? " href="#dom-corsoptions-methods">methods</a>;
  <a class="n" data-link-type="idl-name" href="#typedefdef-corsoptionlist">CORSOptionList</a>? <a class="nv idl-code" data-link-type="dict-member" data-type="CORSOptionList? " href="#dom-corsoptions-headers">headers</a>;
};

</pre>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> It may be a dangerous (or at least confusing) footgun to allow certain
headers to be set on an origin (consider <code>Content-Type</code> or <code>Content-Length</code>,
for instance). Perhaps it would be reasonable to limit the <a data-link-type="dfn" href="#headers"><code>headers</code></a> member to some whitelist of expected headers?<a href="#issue-a997f997"> ↵ </a></div>
   <div class="issue"> WebIDL is almost certainly the wrong way to describe the way the <a data-link-type="dfn" href="#origin-policy"><code>Origin-Policy</code></a> header’s value is constructed. Still, it makes writing
the spec quite a bit simpler, so. We’ll come up with something better
later. Possibly as part of the JSON HTTP Header Field encoding work
ongoing in the HTTP WG.<a href="#issue-35d576f3"> ↵ </a></div>
   <div class="issue"> Write this algorithm.<a href="#issue-7275c976"> ↵ </a></div>
   <div class="issue"> Should we allow service workers to intercept/set policy? Maybe only if they
  are scoped to the whole origin?<a href="#issue-43a867ce"> ↵ </a></div>
   <div class="issue"> Is there a better way to define validity? JSON schema?<a href="#issue-d22f5cea"> ↵ </a></div>
   <div class="issue"> Give some reasonable recommendations here, with links to tutorials if possible.<a href="#issue-7b28cc0b"> ↵ </a></div>
   <div class="issue"> Spell this out with an example.<a href="#issue-7cbc18d1"> ↵ </a></div>
   <div class="issue"> Add some considerations here.<a href="#issue-3b945ec3"> ↵ </a></div>
  </div>
  <aside class="dfn-panel" data-for="origin-policy-object">
   <b><a href="#origin-policy-object">#origin-policy-object</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-origin-policy-object-1">2.1. Concepts</a> <a href="#ref-for-origin-policy-object-2">(2)</a> <a href="#ref-for-origin-policy-object-3">(3)</a>
    <li><a href="#ref-for-origin-policy-object-4">3.2. 
  Evict origin’s cached manifest. </a>
    <li><a href="#ref-for-origin-policy-object-5">3.4.3. 
  Apply an Origin Policy to response. </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="origin-policy-object-body">
   <b><a href="#origin-policy-object-body">#origin-policy-object-body</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-origin-policy-object-body-1">3.4.3. 
  Apply an Origin Policy to response. </a>
    <li><a href="#ref-for-origin-policy-object-body-2">3.4.4. 
  Does Origin Policy bypass request’s CORS-preflight request? </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="origin-policy-store">
   <b><a href="#origin-policy-store">#origin-policy-store</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-origin-policy-store-1">2.1. Concepts</a> <a href="#ref-for-origin-policy-store-2">(2)</a>
    <li><a href="#ref-for-origin-policy-store-3">3.1. 
  Retrieve origin’s manifest version. </a> <a href="#ref-for-origin-policy-store-4">(2)</a>
    <li><a href="#ref-for-origin-policy-store-5">3.2. 
  Evict origin’s cached manifest. </a> <a href="#ref-for-origin-policy-store-6">(2)</a>
    <li><a href="#ref-for-origin-policy-store-7">3.4.2. 
  Process response for Origin Policy. </a>
    <li><a href="#ref-for-origin-policy-store-8">3.4.3. 
  Apply an Origin Policy to response. </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="retrieve-an-origin-policy-for-an-origin">
   <b><a href="#retrieve-an-origin-policy-for-an-origin">#retrieve-an-origin-policy-for-an-origin</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-retrieve-an-origin-policy-for-an-origin-1">3.4.3. 
  Apply an Origin Policy to response. </a>
    <li><a href="#ref-for-retrieve-an-origin-policy-for-an-origin-2">3.4.4. 
  Does Origin Policy bypass request’s CORS-preflight request? </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="evict-an-origin-policy-for-an-origin">
   <b><a href="#evict-an-origin-policy-for-an-origin">#evict-an-origin-policy-for-an-origin</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-evict-an-origin-policy-for-an-origin-1">3.2. 
  Evict origin’s cached manifest. </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="origin-policy">
   <b><a href="#origin-policy">#origin-policy</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-origin-policy-1">1.1. Examples</a> <a href="#ref-for-origin-policy-2">(2)</a> <a href="#ref-for-origin-policy-3">(3)</a> <a href="#ref-for-origin-policy-4">(4)</a> <a href="#ref-for-origin-policy-5">(5)</a> <a href="#ref-for-origin-policy-6">(6)</a>
    <li><a href="#ref-for-origin-policy-7">2.3.4. Syntax</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="grammardef-manifest-name">
   <b><a href="#grammardef-manifest-name">#grammardef-manifest-name</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-grammardef-manifest-name-1">2.2. The Origin-Policy HTTP Header Field</a>
    <li><a href="#ref-for-grammardef-manifest-name-2">3.4.2. 
  Process response for Origin Policy. </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="origin-policy-manifest">
   <b><a href="#origin-policy-manifest">#origin-policy-manifest</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-origin-policy-manifest-1">1. Introduction</a>
    <li><a href="#ref-for-origin-policy-manifest-2">2.1. Concepts</a>
    <li><a href="#ref-for-origin-policy-manifest-3">2.3.1. The origin-policy well-known location</a> <a href="#ref-for-origin-policy-manifest-4">(2)</a> <a href="#ref-for-origin-policy-manifest-5">(3)</a>
    <li><a href="#ref-for-origin-policy-manifest-6">3.4.2. 
  Process response for Origin Policy. </a>
    <li><a href="#ref-for-origin-policy-manifest-7">3.4.4. 
  Does Origin Policy bypass request’s CORS-preflight request? </a>
    <li><a href="#ref-for-origin-policy-manifest-8">5.4. CSP: Nonces and 'strict-dynamic'</a>
    <li><a href="#ref-for-origin-policy-manifest-9">7.2. Creation of the well-known location origin-policy</a> <a href="#ref-for-origin-policy-manifest-10">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="headers">
   <b><a href="#headers">#headers</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-headers-1">1.1. Examples</a>
    <li><a href="#ref-for-headers-2">2.3. The Origin Policy Manifest File</a>
    <li><a href="#ref-for-headers-3">2.3.2. The headers member</a>
    <li><a href="#ref-for-headers-4">2.3.3. The cors-preflight and unsafe-cors-preflight-with-credentials members</a>
    <li><a href="#ref-for-headers-5">2.3.3.1. Examples</a>
    <li><a href="#ref-for-headers-6">3.4.3. 
  Apply an Origin Policy to response. </a>
    <li><a href="#ref-for-headers-7">4.2. Why .well-known?</a>
    <li><a href="#ref-for-headers-8">5.4. CSP: Nonces and 'strict-dynamic'</a>
    <li><a href="#ref-for-headers-9">8. Acknowledgements</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="baseline-headers">
   <b><a href="#baseline-headers">#baseline-headers</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-baseline-headers-1">2.3.2. The headers member</a>
    <li><a href="#ref-for-baseline-headers-2">3.4.3. 
  Apply an Origin Policy to response. </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="fallback-headers">
   <b><a href="#fallback-headers">#fallback-headers</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-fallback-headers-1">2.3.2. The headers member</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-httpheader-name">
   <b><a href="#dom-httpheader-name">#dom-httpheader-name</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-httpheader-name-1">1.1. Examples</a> <a href="#ref-for-dom-httpheader-name-2">(2)</a> <a href="#ref-for-dom-httpheader-name-3">(3)</a> <a href="#ref-for-dom-httpheader-name-4">(4)</a> <a href="#ref-for-dom-httpheader-name-5">(5)</a>
    <li><a href="#ref-for-dom-httpheader-name-6">2.3. The Origin Policy Manifest File</a> <a href="#ref-for-dom-httpheader-name-7">(2)</a> <a href="#ref-for-dom-httpheader-name-8">(3)</a> <a href="#ref-for-dom-httpheader-name-9">(4)</a> <a href="#ref-for-dom-httpheader-name-10">(5)</a>
    <li><a href="#ref-for-dom-httpheader-name-11">2.3.3.1. Examples</a>
    <li><a href="#ref-for-dom-httpheader-name-12">2.3.4. Syntax</a>
    <li><a href="#ref-for-dom-httpheader-name-13">3.4.3. 
  Apply an Origin Policy to response. </a>
    <li><a href="#ref-for-dom-httpheader-name-14">5.4. CSP: Nonces and 'strict-dynamic'</a> <a href="#ref-for-dom-httpheader-name-15">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-httpheader-value">
   <b><a href="#dom-httpheader-value">#dom-httpheader-value</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-httpheader-value-1">1.1. Examples</a> <a href="#ref-for-dom-httpheader-value-2">(2)</a> <a href="#ref-for-dom-httpheader-value-3">(3)</a> <a href="#ref-for-dom-httpheader-value-4">(4)</a> <a href="#ref-for-dom-httpheader-value-5">(5)</a>
    <li><a href="#ref-for-dom-httpheader-value-6">2.3. The Origin Policy Manifest File</a> <a href="#ref-for-dom-httpheader-value-7">(2)</a> <a href="#ref-for-dom-httpheader-value-8">(3)</a> <a href="#ref-for-dom-httpheader-value-9">(4)</a> <a href="#ref-for-dom-httpheader-value-10">(5)</a>
    <li><a href="#ref-for-dom-httpheader-value-11">2.3.3.1. Examples</a>
    <li><a href="#ref-for-dom-httpheader-value-12">2.3.4. Syntax</a>
    <li><a href="#ref-for-dom-httpheader-value-13">3.4.3. 
  Apply an Origin Policy to response. </a>
    <li><a href="#ref-for-dom-httpheader-value-14">5.4. CSP: Nonces and 'strict-dynamic'</a> <a href="#ref-for-dom-httpheader-value-15">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-httpheader-type">
   <b><a href="#dom-httpheader-type">#dom-httpheader-type</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-httpheader-type-1">1.1. Examples</a> <a href="#ref-for-dom-httpheader-type-2">(2)</a> <a href="#ref-for-dom-httpheader-type-3">(3)</a> <a href="#ref-for-dom-httpheader-type-4">(4)</a> <a href="#ref-for-dom-httpheader-type-5">(5)</a>
    <li><a href="#ref-for-dom-httpheader-type-6">2.3. The Origin Policy Manifest File</a> <a href="#ref-for-dom-httpheader-type-7">(2)</a> <a href="#ref-for-dom-httpheader-type-8">(3)</a> <a href="#ref-for-dom-httpheader-type-9">(4)</a> <a href="#ref-for-dom-httpheader-type-10">(5)</a>
    <li><a href="#ref-for-dom-httpheader-type-11">2.3.3.1. Examples</a>
    <li><a href="#ref-for-dom-httpheader-type-12">2.3.4. Syntax</a>
    <li><a href="#ref-for-dom-httpheader-type-13">3.4.3. 
  Apply an Origin Policy to response. </a>
    <li><a href="#ref-for-dom-httpheader-type-14">5.4. CSP: Nonces and 'strict-dynamic'</a> <a href="#ref-for-dom-httpheader-type-15">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-httpheadertype-baseline">
   <b><a href="#dom-httpheadertype-baseline">#dom-httpheadertype-baseline</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-httpheadertype-baseline-1">1.1. Examples</a> <a href="#ref-for-dom-httpheadertype-baseline-2">(2)</a> <a href="#ref-for-dom-httpheadertype-baseline-3">(3)</a>
    <li><a href="#ref-for-dom-httpheadertype-baseline-4">2.3. The Origin Policy Manifest File</a> <a href="#ref-for-dom-httpheadertype-baseline-5">(2)</a> <a href="#ref-for-dom-httpheadertype-baseline-6">(3)</a>
    <li><a href="#ref-for-dom-httpheadertype-baseline-7">2.3.4. Syntax</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-httpheadertype-fallback">
   <b><a href="#dom-httpheadertype-fallback">#dom-httpheadertype-fallback</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-httpheadertype-fallback-1">1.1. Examples</a> <a href="#ref-for-dom-httpheadertype-fallback-2">(2)</a>
    <li><a href="#ref-for-dom-httpheadertype-fallback-3">2.3. The Origin Policy Manifest File</a> <a href="#ref-for-dom-httpheadertype-fallback-4">(2)</a>
    <li><a href="#ref-for-dom-httpheadertype-fallback-5">2.3.3.1. Examples</a>
    <li><a href="#ref-for-dom-httpheadertype-fallback-6">2.3.4. Syntax</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="cors-preflight">
   <b><a href="#cors-preflight">#cors-preflight</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-cors-preflight-1">1.1. Examples</a>
    <li><a href="#ref-for-cors-preflight-2">2.3. The Origin Policy Manifest File</a>
    <li><a href="#ref-for-cors-preflight-3">2.3.3.1. Examples</a>
    <li><a href="#ref-for-cors-preflight-4">3.4.4. 
  Does Origin Policy bypass request’s CORS-preflight request? </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="unsafe-cors-preflight-with-credentials">
   <b><a href="#unsafe-cors-preflight-with-credentials">#unsafe-cors-preflight-with-credentials</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-unsafe-cors-preflight-with-credentials-1">2.3.3. The cors-preflight and unsafe-cors-preflight-with-credentials members</a> <a href="#ref-for-unsafe-cors-preflight-with-credentials-2">(2)</a> <a href="#ref-for-unsafe-cors-preflight-with-credentials-3">(3)</a>
    <li><a href="#ref-for-unsafe-cors-preflight-with-credentials-4">2.3.3.1. Examples</a> <a href="#ref-for-unsafe-cors-preflight-with-credentials-5">(2)</a>
    <li><a href="#ref-for-unsafe-cors-preflight-with-credentials-6">3.4.4. 
  Does Origin Policy bypass request’s CORS-preflight request? </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-corsoptions-origins">
   <b><a href="#dom-corsoptions-origins">#dom-corsoptions-origins</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-corsoptions-origins-1">1.1. Examples</a>
    <li><a href="#ref-for-dom-corsoptions-origins-2">2.3. The Origin Policy Manifest File</a>
    <li><a href="#ref-for-dom-corsoptions-origins-3">2.3.3.1. Examples</a> <a href="#ref-for-dom-corsoptions-origins-4">(2)</a> <a href="#ref-for-dom-corsoptions-origins-5">(3)</a>
    <li><a href="#ref-for-dom-corsoptions-origins-6">2.3.4. Syntax</a>
    <li><a href="#ref-for-dom-corsoptions-origins-7">3.4.4. 
  Does Origin Policy bypass request’s CORS-preflight request? </a> <a href="#ref-for-dom-corsoptions-origins-8">(2)</a> <a href="#ref-for-dom-corsoptions-origins-9">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-wildcard">
   <b><a href="#dom-wildcard">#dom-wildcard</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-wildcard-1">2.3.3. The cors-preflight and unsafe-cors-preflight-with-credentials members</a> <a href="#ref-for-dom-wildcard-2">(2)</a> <a href="#ref-for-dom-wildcard-3">(3)</a> <a href="#ref-for-dom-wildcard-4">(4)</a> <a href="#ref-for-dom-wildcard-5">(5)</a>
    <li><a href="#ref-for-dom-wildcard-6">2.3.4. Syntax</a>
    <li><a href="#ref-for-dom-wildcard-7">3.4.4. 
  Does Origin Policy bypass request’s CORS-preflight request? </a> <a href="#ref-for-dom-wildcard-8">(2)</a> <a href="#ref-for-dom-wildcard-9">(3)</a> <a href="#ref-for-dom-wildcard-10">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-corsoptions-methods">
   <b><a href="#dom-corsoptions-methods">#dom-corsoptions-methods</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-corsoptions-methods-1">2.3.3.1. Examples</a>
    <li><a href="#ref-for-dom-corsoptions-methods-2">2.3.4. Syntax</a>
    <li><a href="#ref-for-dom-corsoptions-methods-3">3.4.4. 
  Does Origin Policy bypass request’s CORS-preflight request? </a> <a href="#ref-for-dom-corsoptions-methods-4">(2)</a> <a href="#ref-for-dom-corsoptions-methods-5">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-corsoptions-headers">
   <b><a href="#dom-corsoptions-headers">#dom-corsoptions-headers</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-corsoptions-headers-1">2.3.3.1. Examples</a>
    <li><a href="#ref-for-dom-corsoptions-headers-2">2.3.4. Syntax</a>
    <li><a href="#ref-for-dom-corsoptions-headers-3">3.4.4. 
  Does Origin Policy bypass request’s CORS-preflight request? </a> <a href="#ref-for-dom-corsoptions-headers-4">(2)</a> <a href="#ref-for-dom-corsoptions-headers-5">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="enumdef-httpheadertype">
   <b><a href="#enumdef-httpheadertype">#enumdef-httpheadertype</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-enumdef-httpheadertype-1">2.3.2. The headers member</a>
    <li><a href="#ref-for-enumdef-httpheadertype-2">2.3.4. Syntax</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-httpheader">
   <b><a href="#dictdef-httpheader">#dictdef-httpheader</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-httpheader-1">2.3.2. The headers member</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="enumdef-wildcard">
   <b><a href="#enumdef-wildcard">#enumdef-wildcard</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-enumdef-wildcard-1">2.3.4. Syntax</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="typedefdef-corsoptionlist">
   <b><a href="#typedefdef-corsoptionlist">#typedefdef-corsoptionlist</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-typedefdef-corsoptionlist-1">2.3.3. The cors-preflight and unsafe-cors-preflight-with-credentials members</a> <a href="#ref-for-typedefdef-corsoptionlist-2">(2)</a> <a href="#ref-for-typedefdef-corsoptionlist-3">(3)</a>
    <li><a href="#ref-for-typedefdef-corsoptionlist-4">2.3.4. Syntax</a> <a href="#ref-for-typedefdef-corsoptionlist-5">(2)</a> <a href="#ref-for-typedefdef-corsoptionlist-6">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-corsoptions">
   <b><a href="#dictdef-corsoptions">#dictdef-corsoptions</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-corsoptions-1">2.3.3. The cors-preflight and unsafe-cors-preflight-with-credentials members</a>
    <li><a href="#ref-for-dictdef-corsoptions-2">3.4.4. 
  Does Origin Policy bypass request’s CORS-preflight request? </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="evict-for-origin">
   <b><a href="#evict-for-origin">#evict-for-origin</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-evict-for-origin-1">3.4.2. 
  Process response for Origin Policy. </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="html-apply-policy">
   <b><a href="#html-apply-policy">#html-apply-policy</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-html-apply-policy-1">3.3. HTML Integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="fetch-prepare-request">
   <b><a href="#fetch-prepare-request">#fetch-prepare-request</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-fetch-prepare-request-1">3.4. Fetch Integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="fetch-parse-response">
   <b><a href="#fetch-parse-response">#fetch-parse-response</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-fetch-parse-response-1">3.4. Fetch Integration</a> <a href="#ref-for-fetch-parse-response-2">(2)</a> <a href="#ref-for-fetch-parse-response-3">(3)</a> <a href="#ref-for-fetch-parse-response-4">(4)</a>
    <li><a href="#ref-for-fetch-parse-response-5">5.3. Server Push</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="fetch-apply-policy">
   <b><a href="#fetch-apply-policy">#fetch-apply-policy</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-fetch-apply-policy-1">3.4. Fetch Integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="fetch-bypass-preflight">
   <b><a href="#fetch-bypass-preflight">#fetch-bypass-preflight</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-fetch-bypass-preflight-1">2.3.3.1. Examples</a> <a href="#ref-for-fetch-bypass-preflight-2">(2)</a>
    <li><a href="#ref-for-fetch-bypass-preflight-3">3.4. Fetch Integration</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

        document.body.addEventListener("click", function(e) {
            var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
            // Find the dfn element or panel, if any, that was clicked on.
            var el = e.target;
            var target;
            var hitALink = false;
            while(el.parentElement) {
                if(el.tagName == "A") {
                    // Clicking on a link in a <dfn> shouldn't summon the panel
                    hitALink = true;
                }
                if(el.classList.contains("dfn-paneled")) {
                    target = "dfn";
                    break;
                }
                if(el.classList.contains("dfn-panel")) {
                    target = "dfn-panel";
                    break;
                }
                el = el.parentElement;
            }
            if(target != "dfn-panel") {
                // Turn off any currently "on" or "activated" panels.
                queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
                    el.classList.remove("on");
                    el.classList.remove("activated");
                });
            }
            if(target == "dfn" && !hitALink) {
                // open the panel
                var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
                if(dfnPanel) {
                    console.log(dfnPanel);
                    dfnPanel.classList.add("on");
                    var rect = el.getBoundingClientRect();
                    dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
                    dfnPanel.style.top = window.scrollY + rect.top + "px";
                    var panelRect = dfnPanel.getBoundingClientRect();
                    var panelWidth = panelRect.right - panelRect.left;
                    if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                        // Reposition, because the panel is overflowing
                        dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
                    }
                } else {
                    console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
                }
            } else if(target == "dfn-panel") {
                // Switch it to "activated" state, which pins it.
                el.classList.add("activated");
                el.style.left = null;
                el.style.top = null;
            }

        });
        </script>